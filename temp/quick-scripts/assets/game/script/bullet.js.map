{"version":3,"sources":["bullet.js"],"names":["mvs","require","GLB","cc","Class","extends","Component","properties","_bType","BulletType","Normal","bType","get","set","value","type","speed","boomPrefab","Prefab","initData","parent","pos","node","position","rotation","radY","Math","PI","radX","speedY","sin","speedX","cos","hostplayer","getComponent","playerId","userInfo","id","opacity","onCollisionEnter","other","group","game","groupList","groupIndex","duck","duckState","DuckState","Dead","hurt","Special","dead","boom","instantiate","worldPos","convertToWorldSpaceAR","v2","localPos","convertToNodeSpaceAR","Game","BulletManager","recycleBullet","update","dt","x","y","abs"],"mappings":"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","file":"bullet.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\game\\script","sourcesContent":["var mvs = require(\"Matchvs\");\r\nvar GLB = require(\"Glb\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        _bType: BulletType.Normal,\r\n        bType: {\r\n            get() {\r\n                return this._bType;\r\n            },\r\n            set(value) {\r\n                this._bType = value;\r\n            },\r\n            type: BulletType\r\n        },\r\n        speed: 0,\r\n        boomPrefab: cc.Prefab\r\n    },\r\n\r\n    initData: function(parent, pos) {\r\n        this.node.parent = parent.parent;\r\n        this.node.position = pos;\r\n        this.node.rotation = parent.rotation;\r\n\r\n        var radY = (parent.rotation + 90) * Math.PI / 180;\r\n        var radX = (parent.rotation - 90) * Math.PI / 180;\r\n\r\n        this.speedY = this.speed * Math.sin(radY);\r\n        this.speedX = this.speed * Math.cos(radX);\r\n\r\n        this.hostplayer = parent.getComponent('player');\r\n        if (this.hostplayer.playerId !== GLB.userInfo.id) {\r\n            this.node.opacity = 50;\r\n        } else {\r\n            this.node.opacity = 255;\r\n        }\r\n    },\r\n\r\n    onCollisionEnter: function(other) {\r\n        if (this.hostplayer && this.hostplayer.playerId === GLB.userInfo.id) {\r\n            var group = cc.game.groupList[other.node.groupIndex];\r\n            if (group === \"duck\") {\r\n                var duck = other.node.getComponent('duck');\r\n                if (duck && duck.duckState !== DuckState.Dead) {\r\n                    if (this.bType === BulletType.Normal) {\r\n                        duck.hurt(1);\r\n                    } else if (this.bType === BulletType.Special) {\r\n                        duck.dead();\r\n                    }\r\n                    var boom = cc.instantiate(this.boomPrefab);\r\n                    if (boom) {\r\n                        boom.parent = this.node.parent;\r\n                        var worldPos = other.node.convertToWorldSpaceAR(cc.v2(0,0));\r\n                        var localPos = this.node.parent.convertToNodeSpaceAR(worldPos);\r\n                        boom.position = localPos;\r\n                    }\r\n                    Game.BulletManager.recycleBullet(this);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    update: function(dt) {\r\n        this.node.x += dt * this.speedX;\r\n        this.node.y += dt * this.speedY;\r\n\r\n        if (Math.abs(this.node.position.x) > 640 || Math.abs(this.node.position.y) > 360) {\r\n            Game.BulletManager.recycleBullet(this);\r\n        }\r\n    }\r\n\r\n});\r\n"]}