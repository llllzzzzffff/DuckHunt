{"version":3,"sources":["player.js"],"names":["mvs","require","GLB","cc","Class","extends","Component","properties","label","Label","init","userId","playerId","score","userInfo","id","self","rotateID","setInterval","Game","GameManager","gameState","GameState","Over","clearInterval","Play","engine","sendFrameEvent","JSON","stringify","action","PLAYER_ROTATION_EVENT","rotation","node","start","targetRotation","setRotation","addScore","string","update","dt","lerp","a","b","r","onDestroy"],"mappings":";;;;;;AAAA,IAAIA,MAAMC,QAAQ,SAAR,CAAV;AACA,IAAIC,MAAMD,QAAQ,KAAR,CAAV;AACAE,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;AAELC,gBAAY;AACRC,eAAOL,GAAGM;AADF,KAFP;AAKLC,UAAM,cAASC,MAAT,EAAiB;AAAA;;AACnB,aAAKC,QAAL,GAAgBD,MAAhB;AACA,aAAKE,KAAL,GAAa,CAAb;AACA,YAAIX,IAAIY,QAAJ,CAAaC,EAAb,KAAoB,KAAKH,QAA7B,EAAuC;AACnC,gBAAII,OAAO,IAAX;AACA,iBAAKC,QAAL,GAAgBC,YAAY,YAAM;AAC9B,oBAAIC,KAAKC,WAAL,CAAiBC,SAAjB,KAA+BC,UAAUC,IAA7C,EAAmD;AAC/CC,kCAAc,MAAKP,QAAnB;AACH,iBAFD,MAEO;AACH,wBAAGE,KAAKC,WAAL,CAAiBC,SAAjB,KAA+BC,UAAUG,IAA5C,EAAkD;AAC9CzB,4BAAI0B,MAAJ,CAAWC,cAAX,CAA0BC,KAAKC,SAAL,CAAe;AACrCC,oCAAQ5B,IAAI6B,qBADyB;AAErCC,sCAAUhB,KAAKiB,IAAL,CAAUD;AAFiB,yBAAf,CAA1B;AAIH;AACJ;AACJ,aAXe,EAWb,GAXa,CAAhB;AAYH;AACJ,KAvBI;;AAyBLE,WAAO,iBAAW;AACd,aAAKC,cAAL,GAAsB,KAAKF,IAAL,CAAUD,QAAhC;AACH,KA3BI;;AA6BLI,eA7BK,uBA6BOJ,QA7BP,EA6BiB;AAClB,aAAKG,cAAL,GAAsBH,QAAtB;AACH,KA/BI;AAiCLK,YAjCK,oBAiCIxB,KAjCJ,EAiCW;AACZ,aAAKA,KAAL,IAAcA,KAAd;AACA,aAAKL,KAAL,CAAW8B,MAAX,GAAoB,KAAKzB,KAAzB;AACH,KApCI;AAsCL0B,UAtCK,kBAsCEC,EAtCF,EAsCM;AACP,YAAItC,IAAIY,QAAJ,CAAaC,EAAb,KAAoB,KAAKH,QAA7B,EAAuC;AACnC,iBAAKqB,IAAL,CAAUD,QAAV,GAAqB,KAAKS,IAAL,CAAU,KAAKR,IAAL,CAAUD,QAApB,EAA8B,KAAKG,cAAnC,EAAmD,KAAKK,EAAxD,CAArB;AACH;AACJ,KA1CI;AA4CLC,QA5CK,gBA4CAC,CA5CA,EA4CGC,CA5CH,EA4CMC,CA5CN,EA4CS;AACV,eAAOF,IAAI,CAACC,IAAID,CAAL,IAAUE,CAArB;AACH,KA9CI;AAgDLC,aAhDK,uBAgDO;AACRrB,sBAAc,KAAKP,QAAnB;AACH;AAlDI,CAAT","file":"player.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\game\\script","sourcesContent":["var mvs = require(\"Matchvs\");\r\nvar GLB = require(\"Glb\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        label: cc.Label\r\n    },\r\n    init: function(userId) {\r\n        this.playerId = userId;\r\n        this.score = 0;\r\n        if (GLB.userInfo.id === this.playerId) {\r\n            var self = this;\r\n            this.rotateID = setInterval(() => {\r\n                if (Game.GameManager.gameState === GameState.Over) {\r\n                    clearInterval(this.rotateID);\r\n                } else {\r\n                    if(Game.GameManager.gameState === GameState.Play) {\r\n                        mvs.engine.sendFrameEvent(JSON.stringify({\r\n                            action: GLB.PLAYER_ROTATION_EVENT,\r\n                            rotation: self.node.rotation\r\n                        }));\r\n                    }\r\n                }\r\n            }, 200);\r\n        }\r\n    },\r\n\r\n    start: function() {\r\n        this.targetRotation = this.node.rotation;\r\n    },\r\n\r\n    setRotation(rotation) {\r\n        this.targetRotation = rotation;\r\n    },\r\n\r\n    addScore(score) {\r\n        this.score += score;\r\n        this.label.string = this.score;\r\n    },\r\n\r\n    update(dt) {\r\n        if (GLB.userInfo.id !== this.playerId) {\r\n            this.node.rotation = this.lerp(this.node.rotation, this.targetRotation, 10 * dt);\r\n        }\r\n    },\r\n\r\n    lerp(a, b, r) {\r\n        return a + (b - a) * r;\r\n    },\r\n\r\n    onDestroy() {\r\n        clearInterval(this.rotateID);\r\n    }\r\n\r\n});\r\n"]}