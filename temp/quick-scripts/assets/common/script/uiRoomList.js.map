{"version":3,"sources":["uiRoomList.js"],"names":["uiPanel","require","mvs","GLB","cc","Class","extends","properties","start","roomPrefab","nodeDict","editBox","getComponent","EditBox","active","on","search","quit","rooms","clientEvent","eventType","getRoomListResponse","joinRoomResponse","getRoomListExResponse","getRoomList","roomRqId","setInterval","string","bind","filter","maxPlayer","mode","canWatch","roomProperty","full","state","sort","order","pageNo","pageSize","engine","getRoomListEx","data","j","length","destroy","roomInfos","a","b","roomID","i","room","instantiate","parent","roomScript","setData","push","roomAttrs","rsp","clearInterval","uiFunc","closeUI","node","name","roomIdLb","status","console","log","roomInfo","roomUserInfoList","some","x","userId","userInfo","id","userProfile","MAX_PLAYER_COUNT","Canvas","instance","designResolution","height","width","openUI","obj","joinRoomInit","onDestroy","window","wx","offKeyboardComplete","offKeyboardInput","hideKeyboard","off"],"mappings":"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","file":"uiRoomList.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\common\\script","sourcesContent":["var uiPanel = require(\"uiPanel\");\r\nvar mvs = require(\"Matchvs\");\r\nvar GLB = require(\"Glb\");\r\ncc.Class({\r\n    extends: uiPanel,\r\n\r\n    properties: {},\r\n\r\n    start() {\r\n        this.roomPrefab = this.nodeDict[\"roomPrefab\"];\r\n        this.editBox = this.nodeDict[\"editBox\"].getComponent(cc.EditBox);\r\n        this.roomPrefab.active = false;\r\n        this.nodeDict[\"search\"].on(\"click\", this.search, this);\r\n        this.nodeDict[\"quit\"].on(\"click\", this.quit, this);\r\n\r\n\r\n        this.rooms = [];\r\n\r\n        clientEvent.on(clientEvent.eventType.getRoomListResponse, this.getRoomListResponse, this);\r\n        clientEvent.on(clientEvent.eventType.joinRoomResponse, this.joinRoomResponse, this);\r\n        clientEvent.on(clientEvent.eventType.getRoomListExResponse, this.getRoomListExResponse, this);\r\n\r\n        this.getRoomList();\r\n        this.roomRqId = setInterval(function() {\r\n            if (this.editBox.string === '') {\r\n                this.getRoomList();\r\n            }\r\n        }.bind(this), 5000);\r\n    },\r\n\r\n    getRoomList: function() {\r\n        var filter = {\r\n            maxPlayer: 0,\r\n            mode: 0,\r\n            canWatch: 0,\r\n            roomProperty: \"\",\r\n            full: 2,\r\n            state: 1,\r\n            sort: 1,\r\n            order: 0,\r\n            pageNo: 0,\r\n            pageSize: 20\r\n        }\r\n        mvs.engine.getRoomListEx(filter);\r\n    },\r\n\r\n    getRoomListResponse: function(data) {\r\n        for (var j = 0; j < this.rooms.length; j++) {\r\n            this.rooms[j].destroy();\r\n        }\r\n        this.rooms = [];\r\n        data.roomInfos.sort(function(a, b) {\r\n            return a.roomID - b.roomID;\r\n        });\r\n        for (var i = 0; i < data.roomInfos.length; i++) {\r\n            var room = cc.instantiate(this.roomPrefab);\r\n            room.active = true;\r\n            room.parent = this.roomPrefab.parent;\r\n            var roomScript = room.getComponent('roomInfo');\r\n            roomScript.setData(data.roomInfos[i]);\r\n\r\n            this.rooms.push(room);\r\n        }\r\n    },\r\n\r\n    getRoomListExResponse: function(data) {\r\n        for (var j = 0; j < this.rooms.length; j++) {\r\n            this.rooms[j].destroy();\r\n        }\r\n        this.rooms = [];\r\n        this.roomAttrs = data.rsp.roomAttrs;\r\n        for (var i = 0; i < data.rsp.roomAttrs.length; i++) {\r\n            var room = cc.instantiate(this.roomPrefab);\r\n            room.active = true;\r\n            room.parent = this.roomPrefab.parent;\r\n            var roomScript = room.getComponent('roomInfo');\r\n            roomScript.setData(data.rsp.roomAttrs[i]);\r\n\r\n            this.rooms.push(room);\r\n        }\r\n    },\r\n\r\n    quit: function() {\r\n        clearInterval(this.roomRqId);\r\n        uiFunc.closeUI(this.node.name);\r\n        this.node.destroy();\r\n    },\r\n\r\n    search: function() {\r\n        if (this.editBox.string === '') {\r\n            for (var i = 0; i < this.rooms.length; i++) {\r\n                this.rooms[i].active = true;\r\n            }\r\n        } else {\r\n            for (var j = 0; j < this.rooms.length; j++) {\r\n                var roomScript = this.rooms[j].getComponent('roomInfo');\r\n                if (roomScript.roomIdLb.string == this.editBox.string) {\r\n                    this.rooms[j].active = true;\r\n                } else {\r\n                    this.rooms[j].active = false;\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    joinRoomResponse: function(data) {\r\n        if (data.status !== 200) {\r\n            console.log('进入房间失败,异步回调错误码: ' + data.status);\r\n        } else {\r\n            console.log('进入房间成功');\r\n            console.log('房间号: ' + data.roomInfo.roomID);\r\n            if (!data.roomUserInfoList.some(function(x) {\r\n                return x.userId === GLB.userInfo.id;\r\n            })) {\r\n                data.roomUserInfoList.push({\r\n                    userId: GLB.userInfo.id,\r\n                    userProfile: \"\"\r\n                });\r\n            }\r\n            // 设置房间最大人数--\r\n            for (var i = 0; i < this.roomAttrs.length; i++) {\r\n                if (data.roomInfo.roomID === this.roomAttrs[i].roomID) {\r\n                    GLB.MAX_PLAYER_COUNT = this.roomAttrs[i].maxPlayer;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\r\n                uiFunc.openUI(\"uiRoomVer\", function(obj) {\r\n                    var room = obj.getComponent('uiRoom');\r\n                    room.joinRoomInit(data.roomUserInfoList, data.roomInfo);\r\n                    uiFunc.closeUI(this.node.name);\r\n                    this.node.destroy();\r\n                }.bind(this));\r\n            } else {\r\n                uiFunc.openUI(\"uiRoom\", function(obj) {\r\n                    var room = obj.getComponent('uiRoom');\r\n                    room.joinRoomInit(data.roomUserInfoList, data.roomInfo);\r\n                    uiFunc.closeUI(this.node.name);\r\n                    this.node.destroy();\r\n                }.bind(this));\r\n            }\r\n        }\r\n    },\r\n\r\n    onDestroy() {\r\n        if (window.wx) {\r\n            wx.offKeyboardComplete();\r\n            wx.offKeyboardInput();\r\n            wx.hideKeyboard();\r\n        }\r\n        clearInterval(this.roomRqId);\r\n        clientEvent.off(clientEvent.eventType.getRoomListResponse, this.getRoomListResponse, this);\r\n        clientEvent.off(clientEvent.eventType.joinRoomResponse, this.joinRoomResponse, this);\r\n        clientEvent.off(clientEvent.eventType.getRoomListExResponse, this.getRoomListExResponse, this);\r\n    }\r\n});\r\n"]}