{"version":3,"sources":["uiGamePanel.js"],"names":["mvs","require","GLB","cc","Class","extends","properties","gun","default","type","Node","gunOther1","gunOther2","fireSmallBtn","Button","fireBigBtn","timeLb","Label","coinLb","bulletLb","bulletIcon","duckAudio","url","AudioClip","fireAudio","firePlusAudio","dirLeftMaxAngle","dirRightMaxAngle","onLoad","_super","fireCd","bgmId","audioEngine","play","node","on","Game","GameManager","gameState","GameState","Play","BulletManager","smallBulletCnt","msg","action","PLAYER_FIRE_EVENT","bulletType","BulletType","Normal","sendEventEx","updateBulletLb","clientEvent","dispatch","eventType","loadBullet","coin","nodeDict","getComponent","Animation","Special","updateCoin","anim","onFinished","time","setTime","roundStart","gameOver","leaveRoomNotify","leaveRoom","exit","data","Over","uiFunc","openUI","obj","uiTip","leaveRoomInfo","userId","userInfo","id","setData","bind","AudioSource","stop","setTimeout","directionTouchMove","slider","range","rotation","progress","string","Math","floor","update","dt","onDestroy","off"],"mappings":"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","file":"uiGamePanel.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\common\\script","sourcesContent":["var mvs = require(\"Matchvs\");\r\nvar GLB = require(\"Glb\");\r\ncc.Class({\r\n    extends: require(\"uiPanel\"),\r\n\r\n    properties: {\r\n        gun: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        gunOther1: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        gunOther2: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        fireSmallBtn: {\r\n            default: null,\r\n            type: cc.Button\r\n        },\r\n        fireBigBtn: {\r\n            default: null,\r\n            type: cc.Button\r\n        },\r\n        timeLb: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        coinLb: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        bulletLb: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        bulletIcon: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        duckAudio: {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n        fireAudio: {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n        firePlusAudio: {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n        dirLeftMaxAngle: -45,\r\n        dirRightMaxAngle: 45\r\n    },\r\n\r\n    onLoad() {\r\n        this._super();\r\n        this.fireCd = 0;\r\n        this.bgmId = cc.audioEngine.play(this.duckAudio, true, 1);\r\n        this.fireSmallBtn.node.on(\"click\", function() {\r\n            // 是否有子弹，子弹cd\r\n            if (Game.GameManager.gameState !== GameState.Play) {\r\n                return;\r\n            }\r\n            if (Game.BulletManager.smallBulletCnt > 0 && this.fireCd <= 0) {\r\n                var msg = {\r\n                    action: GLB.PLAYER_FIRE_EVENT,\r\n                    bulletType: BulletType.Normal\r\n                };\r\n                Game.GameManager.sendEventEx(msg);\r\n                cc.audioEngine.play(this.fireAudio, false, 1);\r\n                Game.BulletManager.smallBulletCnt--;\r\n                this.fireCd = 0.5;\r\n                this.updateBulletLb();\r\n                if (Game.BulletManager.smallBulletCnt <= 0) {\r\n                    // 装弹--\r\n                    clientEvent.dispatch(clientEvent.eventType.loadBullet);\r\n                }\r\n            }\r\n        }, this);\r\n\r\n        this.fireBigBtn.node.on(\"click\", function() {\r\n            // 金币兑换子弹是否足够--\r\n            if (Game.GameManager.gameState !== GameState.Play) {\r\n                return;\r\n            }\r\n            if (Game.GameManager.coin >= 1 && this.fireCd <= 0) {\r\n                Game.GameManager.coin--;\r\n                this.nodeDict[\"coin\"].getComponent(cc.Animation).play();\r\n                this.fireCd = 0.5;\r\n                var msg = {\r\n                    action: GLB.PLAYER_FIRE_EVENT,\r\n                    bulletType: BulletType.Special\r\n                };\r\n                Game.GameManager.sendEventEx(msg);\r\n                cc.audioEngine.play(this.firePlusAudio, false, 1);\r\n                clientEvent.dispatch(clientEvent.eventType.updateCoin);\r\n            }\r\n        }, this);\r\n\r\n        this.anim = this.bulletIcon.getComponent(cc.Animation);\r\n        this.anim.on('finished', this.onFinished, this);\r\n        this.updateCoin();\r\n\r\n        clientEvent.on(clientEvent.eventType.time, this.setTime, this);\r\n        clientEvent.on(clientEvent.eventType.updateCoin, this.updateCoin, this);\r\n        clientEvent.on(clientEvent.eventType.loadBullet, this.loadBullet, this);\r\n        clientEvent.on(clientEvent.eventType.roundStart, this.roundStart, this);\r\n        clientEvent.on(clientEvent.eventType.gameOver, this.gameOver, this);\r\n        clientEvent.on(clientEvent.eventType.leaveRoomNotify, this.leaveRoom, this);\r\n\r\n        this.nodeDict[\"exit\"].on(\"click\", this.exit, this);\r\n    },\r\n\r\n    leaveRoom(data) {\r\n        if (Game.GameManager.gameState !== GameState.Over) {\r\n            uiFunc.openUI(\"uiTip\", function(obj) {\r\n                var uiTip = obj.getComponent(\"uiTip\");\r\n                if (uiTip) {\r\n                    if (data.leaveRoomInfo.userId !== GLB.userInfo.id) {\r\n                        uiTip.setData(\"对手离开了游戏\");\r\n                    }\r\n                }\r\n            }.bind(this));\r\n        }\r\n    },\r\n\r\n    exit() {\r\n        uiFunc.openUI(\"uiExit\");\r\n    },\r\n\r\n    gameOver: function() {\r\n        this.nodeDict['gameOver'].getComponent(cc.Animation).play();\r\n        this.nodeDict['gameOver'].getComponent(cc.AudioSource).play();\r\n        cc.audioEngine.stop(this.bgmId);\r\n    },\r\n\r\n    roundStart() {\r\n        this.nodeDict[\"duckGuide\"].getComponent(cc.Animation).play();\r\n        setTimeout(function() {\r\n            this.nodeDict['readyGo'].getComponent(cc.Animation).play();\r\n            this.nodeDict['readyGo'].getComponent(cc.AudioSource).play();\r\n        }.bind(this), 4500);\r\n    },\r\n\r\n    directionTouchMove: function(slider) {\r\n        var range = this.dirRightMaxAngle - this.dirLeftMaxAngle;\r\n        var rotation = this.dirLeftMaxAngle + range * (slider.progress);\r\n        this.gun.rotation = rotation;\r\n    },\r\n\r\n    setTime: function(time) {\r\n        this.timeLb.string = time;\r\n        if (time === 10) {\r\n            this.nodeDict[\"clock\"].getComponent(cc.Animation).play();\r\n        }\r\n    },\r\n\r\n    updateCoin: function() {\r\n        this.coinLb.string = Math.floor(Game.GameManager.coin);\r\n    },\r\n\r\n    loadBullet: function() {\r\n        this.anim.play();\r\n    },\r\n\r\n    updateBulletLb: function() {\r\n        this.bulletLb.string = Game.BulletManager.smallBulletCnt;\r\n    },\r\n\r\n    onFinished: function() {\r\n        Game.BulletManager.loadBullet();\r\n        this.updateBulletLb();\r\n    },\r\n\r\n    update(dt) {\r\n        if (this.fireCd > 0) {\r\n            this.fireCd -= dt;\r\n        }\r\n    },\r\n\r\n    onDestroy() {\r\n        cc.audioEngine.stop(this.bgmId);\r\n        clientEvent.off(clientEvent.eventType.time, this.setTime, this);\r\n        clientEvent.off(clientEvent.eventType.updateCoin, this.updateCoin, this);\r\n        clientEvent.off(clientEvent.eventType.loadBullet, this.loadBullet, this);\r\n        clientEvent.off(clientEvent.eventType.roundStart, this.roundStart, this);\r\n        clientEvent.off(clientEvent.eventType.gameOver, this.gameOver, this);\r\n        clientEvent.off(clientEvent.eventType.leaveRoomNotify, this.leaveRoom, this);\r\n    }\r\n});\r\n"]}