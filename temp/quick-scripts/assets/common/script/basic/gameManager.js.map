{"version":3,"sources":["gameManager.js"],"names":["mvs","require","GLB","cc","Class","extends","Component","blockInput","Game","GameManager","getComponent","BlockInputEvents","enabled","setTimeout","node","onLoad","game","addPersistRootNode","director","getCollisionManager","clientEvent","init","dataFunc","loadConfigs","view","enableAutoFullScreen","coin","on","eventType","gameOver","leaveRoomNotify","leaveRoom","network","window","chooseNetworkMode","getRankDataListener","findPlayerByAccountListener","data","gameState","GameState","Play","leaveRoomInfo","owner","userInfo","id","isRoomOwner","gamePanel","uiFunc","findUI","Over","concat","playerUserIds","sort","a","b","playerA","PlayerManager","getPlayerByUserId","playerB","score","Canvas","instance","designResolution","height","width","openUI","obj","uiResultScript","setData","bind","startGame","readyCnt","Pause","loadScene","sendReadyMsg","initPlayers","syncFrame","result","engine","setFrameSync","FRAME_RATE","console","log","setFrameSyncResponse","rsp","mStatus","status","matchVsInit","response","initResponse","errorResponse","joinRoomResponse","joinRoomNotify","leaveRoomResponse","joinOverResponse","createRoomResponse","getRoomListResponse","getRoomDetailResponse","getRoomListExResponse","kickPlayerResponse","kickPlayerNotify","registerUserResponse","loginResponse","logoutResponse","sendEventNotify","frameUpdate","networkStateNotify","channel","platform","gameId","appKey","gameVersion","netNotify","dispatch","leaveRoomMedNotify","kickPlayerRsp","roomInfos","joinOverRsp","roomUserInfoList","roomInfo","roomUserInfo","leaveRoomRsp","disconnect","removePersistRootNode","error","msg","uiTip","logout","registerUser","deviceId","gatewayId","login","token","info","lobbyShow","None","cpProto","JSON","parse","indexOf","GAME_START_EVENT","scores","self","remoteUserIds","userIds","forEach","push","playerId","player","PLAYER_FIRE_EVENT","srcUserId","worldPos","convertToWorldSpaceAR","v2","bulletPoint","parent","convertToNodeSpaceAR","bulletType","BulletType","Normal","BulletManager","spawnSmallBullet","Special","spawnBigBullet","GAME_TIME","gameTime","parseInt","time","SCORE_EVENT","addScore","updateCoin","GAME_OVER_EVENT","Math","floor","READY","length","sendRoundStartMsg","ROUND_START","GameSeconds","timeUpdate","roundStart","action","sendEventEx","i","frameItems","PLAYER_ROTATION_EVENT","srcUserID","setRotation","rotation","clearInterval","timeId","setInterval","recvMsg","uiRankPanel","rankArray","playerAccountGet","loginServer","isConnected","connect","IP","PORT","isOpen","send","nickName","avatarUrl","userInfoReq","userId","stringify"],"mappings":";;;;;;AAAA,IAAIA,MAAMC,QAAQ,SAAR,CAAV;AACA,IAAIC,MAAMD,QAAQ,KAAR,CAAV;;AAEAE,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,cAHK,wBAGQ;AACTC,aAAKC,WAAL,CAAiBC,YAAjB,CAA8BP,GAAGQ,gBAAjC,EAAmDC,OAAnD,GAA6D,IAA7D;AACAC,mBAAW,YAAW;AAClBL,iBAAKC,WAAL,CAAiBK,IAAjB,CAAsBJ,YAAtB,CAAmCP,GAAGQ,gBAAtC,EAAwDC,OAAxD,GAAkE,KAAlE;AACH,SAFD,EAEG,IAFH;AAGH,KARI;AAULG,UAVK,oBAUI;AACLP,aAAKC,WAAL,GAAmB,IAAnB;AACAN,WAAGa,IAAH,CAAQC,kBAAR,CAA2B,KAAKH,IAAhC;AACAX,WAAGe,QAAH,CAAYC,mBAAZ,GAAkCP,OAAlC,GAA4C,IAA5C;AACAQ,oBAAYC,IAAZ;AACAC,iBAASC,WAAT;AACApB,WAAGqB,IAAH,CAAQC,oBAAR,CAA6B,KAA7B;AACA,aAAKC,IAAL,GAAY,GAAZ;AACAN,oBAAYO,EAAZ,CAAeP,YAAYQ,SAAZ,CAAsBC,QAArC,EAA+C,KAAKA,QAApD,EAA8D,IAA9D;AACAT,oBAAYO,EAAZ,CAAeP,YAAYQ,SAAZ,CAAsBE,eAArC,EAAsD,KAAKC,SAA3D,EAAsE,IAAtE;AACA,aAAKC,OAAL,GAAeC,OAAOD,OAAtB;AACA,aAAKA,OAAL,CAAaE,iBAAb;AACA,aAAKC,mBAAL;AACA,aAAKC,2BAAL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,KA7CI;;;AA+CLL,eAAW,mBAASM,IAAT,EAAe;AACtB;AACA,YAAI7B,KAAKC,WAAL,CAAiB6B,SAAjB,KAA+BC,UAAUC,IAA7C,EAAmD;AAC/C,gBAAIH,KAAKI,aAAL,CAAmBC,KAAnB,KAA6BxC,IAAIyC,QAAJ,CAAaC,EAA9C,EAAkD;AAC9C1C,oBAAI2C,WAAJ,GAAkB,IAAlB;AACH;AACJ;AACJ,KAtDI;;AAwDLhB,cAAU,oBAAW;AACjB;AACA,YAAIiB,YAAYC,OAAOC,MAAP,CAAc,aAAd,CAAhB;AACA,YAAIF,aAAatC,KAAKC,WAAL,CAAiB6B,SAAjB,KAA+BC,UAAUU,IAA1D,EAAgE;AAC5DzC,iBAAKC,WAAL,CAAiB6B,SAAjB,GAA6BC,UAAUU,IAAvC;AACA,gBAAIZ,OAAO,GAAGa,MAAH,CAAUhD,IAAIiD,aAAd,CAAX;AACAd,iBAAKe,IAAL,CAAU,UAASC,CAAT,EAAYC,CAAZ,EAAe;AACrB,oBAAIC,UAAU/C,KAAKgD,aAAL,CAAmBC,iBAAnB,CAAqCJ,CAArC,CAAd;AACA,oBAAIK,UAAUlD,KAAKgD,aAAL,CAAmBC,iBAAnB,CAAqCH,CAArC,CAAd;AACA,oBAAIC,WAAWG,OAAf,EAAwB;AACpB,wBAAIA,QAAQC,KAAR,KAAkBJ,QAAQI,KAA9B,EAAqC;AACjC,+BAAOD,QAAQC,KAAR,GAAgBJ,QAAQI,KAA/B;AACH,qBAFD,MAEO;AACH,4BAAIN,MAAMnD,IAAIyC,QAAJ,CAAaC,EAAvB,EAA2B;AACvB,mCAAO,CAAC,CAAR;AACH,yBAFD,MAEO,IAAIU,MAAMpD,IAAIyC,QAAJ,CAAaC,EAAvB,EAA2B;AAC9B,mCAAO,CAAP;AACH;AACJ;AACJ;AACD,uBAAOS,IAAIC,CAAX;AACH,aAfD;;AAiBAzC,uBAAW,YAAW;AAClB,oBAAIV,GAAGyD,MAAH,CAAUC,QAAV,CAAmBC,gBAAnB,CAAoCC,MAApC,GAA6C5D,GAAGyD,MAAH,CAAUC,QAAV,CAAmBC,gBAAnB,CAAoCE,KAArF,EAA4F;AACxFjB,2BAAOkB,MAAP,CAAc,aAAd,EAA6B,UAASC,GAAT,EAAc;AACvC,4BAAIC,iBAAiBD,IAAIxD,YAAJ,CAAiB,UAAjB,CAArB;AACA,4BAAIyD,cAAJ,EAAoB;AAChBA,2CAAeC,OAAf,CAAuB/B,IAAvB;AACH;AACJ,qBALD;AAMH,iBAPD,MAOO;AACHU,2BAAOkB,MAAP,CAAc,UAAd,EAA0B,UAASC,GAAT,EAAc;AACpC,4BAAIC,iBAAiBD,IAAIxD,YAAJ,CAAiB,UAAjB,CAArB;AACA,4BAAIyD,cAAJ,EAAoB;AAChBA,2CAAeC,OAAf,CAAuB/B,IAAvB;AACH;AACJ,qBALD;AAMH;AACJ,aAhBU,CAgBTgC,IAhBS,CAgBJ,IAhBI,CAAX,EAgBc,IAhBd;AAiBH;AACJ,KAjGI;;AAmGLC,eAAW,qBAAW;AAClB,aAAKC,QAAL,GAAgB,CAAhB;AACA,aAAKjC,SAAL,GAAiBC,UAAUiC,KAA3B;AACArE,WAAGe,QAAH,CAAYuD,SAAZ,CAAsB,MAAtB,EAA8B,YAAW;AACrC1B,mBAAOkB,MAAP,CAAc,aAAd,EAA6B,YAAW;AACpC,qBAAKS,YAAL;AACAlE,qBAAKgD,aAAL,CAAmBmB,WAAnB;AACH,aAH4B,CAG3BN,IAH2B,CAGtB,IAHsB,CAA7B;AAIH,SAL6B,CAK5BA,IAL4B,CAKvB,IALuB,CAA9B;;AAOA,YAAInE,IAAI0E,SAAJ,KAAkB,IAAlB,IAA0B1E,IAAI2C,WAAJ,KAAoB,IAAlD,EAAwD;AACpD,gBAAIgC,SAAS7E,IAAI8E,MAAJ,CAAWC,YAAX,CAAwB7E,IAAI8E,UAA5B,CAAb;AACA,gBAAIH,WAAW,CAAf,EAAkB;AACdI,wBAAQC,GAAR,CAAY,kBAAkBL,MAA9B;AACH;AACJ;AACJ,KAnHI;;AAqHLM,0BAAsB,8BAASC,GAAT,EAAc;AAChC,YAAIA,IAAIC,OAAJ,KAAgB,GAApB,EAAyB;AACrBJ,oBAAQC,GAAR,CAAY,qBAAqBE,IAAIE,MAArC;AACH,SAFD,MAEO;AACHL,oBAAQC,GAAR,CAAY,mBAAmBhF,IAAI8E,UAAnC;AACH;AACJ,KA3HI;;AA6HLO,iBAAa,uBAAW;AACpBvF,YAAIwF,QAAJ,CAAaC,YAAb,GAA4B,KAAKA,YAAL,CAAkBpB,IAAlB,CAAuB,IAAvB,CAA5B;AACArE,YAAIwF,QAAJ,CAAaE,aAAb,GAA6B,KAAKA,aAAL,CAAmBrB,IAAnB,CAAwB,IAAxB,CAA7B;AACArE,YAAIwF,QAAJ,CAAaG,gBAAb,GAAgC,KAAKA,gBAAL,CAAsBtB,IAAtB,CAA2B,IAA3B,CAAhC;AACArE,YAAIwF,QAAJ,CAAaI,cAAb,GAA8B,KAAKA,cAAL,CAAoBvB,IAApB,CAAyB,IAAzB,CAA9B;AACArE,YAAIwF,QAAJ,CAAaK,iBAAb,GAAiC,KAAKA,iBAAL,CAAuBxB,IAAvB,CAA4B,IAA5B,CAAjC;AACArE,YAAIwF,QAAJ,CAAa1D,eAAb,GAA+B,KAAKA,eAAL,CAAqBuC,IAArB,CAA0B,IAA1B,CAA/B;AACArE,YAAIwF,QAAJ,CAAaM,gBAAb,GAAgC,KAAKA,gBAAL,CAAsBzB,IAAtB,CAA2B,IAA3B,CAAhC;AACArE,YAAIwF,QAAJ,CAAaO,kBAAb,GAAkC,KAAKA,kBAAL,CAAwB1B,IAAxB,CAA6B,IAA7B,CAAlC;AACArE,YAAIwF,QAAJ,CAAaQ,mBAAb,GAAmC,KAAKA,mBAAL,CAAyB3B,IAAzB,CAA8B,IAA9B,CAAnC;AACArE,YAAIwF,QAAJ,CAAaS,qBAAb,GAAqC,KAAKA,qBAAL,CAA2B5B,IAA3B,CAAgC,IAAhC,CAArC;AACArE,YAAIwF,QAAJ,CAAaU,qBAAb,GAAqC,KAAKA,qBAAL,CAA2B7B,IAA3B,CAAgC,IAAhC,CAArC;AACArE,YAAIwF,QAAJ,CAAaW,kBAAb,GAAkC,KAAKA,kBAAL,CAAwB9B,IAAxB,CAA6B,IAA7B,CAAlC;AACArE,YAAIwF,QAAJ,CAAaY,gBAAb,GAAgC,KAAKA,gBAAL,CAAsB/B,IAAtB,CAA2B,IAA3B,CAAhC;AACArE,YAAIwF,QAAJ,CAAaa,oBAAb,GAAoC,KAAKA,oBAAL,CAA0BhC,IAA1B,CAA+B,IAA/B,CAApC;AACArE,YAAIwF,QAAJ,CAAac,aAAb,GAA6B,KAAKA,aAAL,CAAmBjC,IAAnB,CAAwB,IAAxB,CAA7B,CAfoB,CAewC;AAC5DrE,YAAIwF,QAAJ,CAAae,cAAb,GAA8B,KAAKA,cAAL,CAAoBlC,IAApB,CAAyB,IAAzB,CAA9B,CAhBoB,CAgB0C;AAC9DrE,YAAIwF,QAAJ,CAAagB,eAAb,GAA+B,KAAKA,eAAL,CAAqBnC,IAArB,CAA0B,IAA1B,CAA/B;AACArE,YAAIwF,QAAJ,CAAaiB,WAAb,GAA2B,KAAKA,WAAL,CAAiBpC,IAAjB,CAAsB,IAAtB,CAA3B;AACArE,YAAIwF,QAAJ,CAAaL,oBAAb,GAAoC,KAAKA,oBAAL,CAA0Bd,IAA1B,CAA+B,IAA/B,CAApC;AACArE,YAAIwF,QAAJ,CAAakB,kBAAb,GAAkC,KAAKA,kBAAL,CAAwBrC,IAAxB,CAA6B,IAA7B,CAAlC;;AAEA;AACA,YAAIQ,SAAS7E,IAAI8E,MAAJ,CAAWzD,IAAX,CAAgBrB,IAAIwF,QAApB,EAA8BtF,IAAIyG,OAAlC,EAA2CzG,IAAI0G,QAA/C,EAAyD1G,IAAI2G,MAA7D,EACT3G,IAAI4G,MADK,EACG5G,IAAI6G,WADP,CAAb;AAEA,YAAIlC,WAAW,CAAf,EAAkB;AACdI,oBAAQC,GAAR,CAAY,eAAeL,MAA3B;AACH;AACDrE,aAAKC,WAAL,CAAiBF,UAAjB;AACH,KA1JI;;AA4JLmG,wBAAoB,4BAASM,SAAT,EAAoB;AACpC5F,oBAAY6F,QAAZ,CAAqB7F,YAAYQ,SAAZ,CAAsBsF,kBAA3C,EAA+DF,SAA/D;AACH,KA9JI;;AAgKLZ,sBAAkB,0BAASA,iBAAT,EAA2B;AACzC,YAAI/D,OAAO;AACP+D,8BAAkBA;AADX,SAAX;AAGAhF,oBAAY6F,QAAZ,CAAqB7F,YAAYQ,SAAZ,CAAsBwE,gBAA3C,EAA6D/D,IAA7D;AACH,KArKI;;AAuKL8D,wBAAoB,4BAASgB,aAAT,EAAwB;AACxC,YAAIA,cAAc7B,MAAd,KAAyB,GAA7B,EAAkC;AAC9BL,oBAAQC,GAAR,CAAY,qBAAqBiC,aAAjC;AACA;AACH;AACD,YAAI9E,OAAO;AACP8E,2BAAeA;AADR,SAAX;AAGA/F,oBAAY6F,QAAZ,CAAqB7F,YAAYQ,SAAZ,CAAsBuE,kBAA3C,EAA+D9D,IAA/D;AACH,KAhLI;;AAkLL6D,2BAAuB,+BAASd,GAAT,EAAc;AACjC,YAAIA,IAAIE,MAAJ,KAAe,GAAnB,EAAwB;AACpBL,oBAAQC,GAAR,CAAY,YAAYE,GAAxB;AACA;AACH;AACD,YAAI/C,OAAO;AACP+C,iBAAKA;AADE,SAAX;AAGAhE,oBAAY6F,QAAZ,CAAqB7F,YAAYQ,SAAZ,CAAsBsE,qBAA3C,EAAkE7D,IAAlE;AACH,KA3LI;;AA6LL4D,2BAAuB,+BAASb,GAAT,EAAc;AACjC,YAAIA,IAAIE,MAAJ,KAAe,GAAnB,EAAwB;AACpBL,oBAAQC,GAAR,CAAY,YAAYE,GAAxB;AACA;AACH;AACD,YAAI/C,OAAO;AACP+C,iBAAKA;AADE,SAAX;AAGAhE,oBAAY6F,QAAZ,CAAqB7F,YAAYQ,SAAZ,CAAsBqE,qBAA3C,EAAkE5D,IAAlE;AACH,KAtMI;;AAwML2D,yBAAqB,6BAASV,MAAT,EAAiB8B,SAAjB,EAA4B;AAC7C,YAAI9B,WAAW,GAAf,EAAoB;AAChBL,oBAAQC,GAAR,CAAY,eAAeI,MAA3B;AACA;AACH;AACD,YAAIjD,OAAO;AACPiD,oBAAQA,MADD;AAEP8B,uBAAWA;AAFJ,SAAX;AAIAhG,oBAAY6F,QAAZ,CAAqB7F,YAAYQ,SAAZ,CAAsBoE,mBAA3C,EAAgE3D,IAAhE;AACH,KAlNI;;AAoNL0D,wBAAoB,4BAASX,GAAT,EAAc;AAC9B,YAAIA,IAAIE,MAAJ,KAAe,GAAnB,EAAwB;AACpBL,oBAAQC,GAAR,CAAY,2BAA2BE,GAAvC;AACA;AACH;AACD,YAAI/C,OAAO;AACP+C,iBAAKA;AADE,SAAX;AAGAhE,oBAAY6F,QAAZ,CAAqB7F,YAAYQ,SAAZ,CAAsBmE,kBAA3C,EAA+D1D,IAA/D;AACH,KA7NI;;AA+NLyD,sBAAkB,0BAASuB,WAAT,EAAsB;AACpC,YAAIA,YAAY/B,MAAZ,KAAuB,GAA3B,EAAgC;AAC5BL,oBAAQC,GAAR,CAAY,oBAAoBmC,WAAhC;AACA;AACH;AACD,YAAIhF,OAAO;AACPgF,yBAAaA;AADN,SAAX;AAGAjG,oBAAY6F,QAAZ,CAAqB7F,YAAYQ,SAAZ,CAAsBkE,gBAA3C,EAA6DzD,IAA7D;AACH,KAxOI;;AA0OLsD,sBAAkB,0BAASL,MAAT,EAAiBgC,gBAAjB,EAAmCC,QAAnC,EAA6C;AAC3D,YAAIjC,WAAW,GAAf,EAAoB;AAChBL,oBAAQC,GAAR,CAAY,yBAAyBI,MAArC;AACA;AACH;AACD,YAAIjD,OAAO;AACPiD,oBAAQA,MADD;AAEPgC,8BAAkBA,gBAFX;AAGPC,sBAAUA;AAHH,SAAX;AAKAnG,oBAAY6F,QAAZ,CAAqB7F,YAAYQ,SAAZ,CAAsB+D,gBAA3C,EAA6DtD,IAA7D;AACH,KArPI;;AAuPLuD,oBAAgB,wBAAS4B,YAAT,EAAuB;AACnC,YAAInF,OAAO;AACPmF,0BAAcA;AADP,SAAX;AAGApG,oBAAY6F,QAAZ,CAAqB7F,YAAYQ,SAAZ,CAAsBgE,cAA3C,EAA2DvD,IAA3D;AACH,KA5PI;;AA8PLwD,uBAAmB,2BAAS4B,YAAT,EAAuB;AACtC,YAAIA,aAAanC,MAAb,KAAwB,GAA5B,EAAiC;AAC7BL,oBAAQC,GAAR,CAAY,qBAAqBuC,YAAjC;AACA;AACH;AACD,YAAIpF,OAAO;AACPoF,0BAAcA;AADP,SAAX;AAGArG,oBAAY6F,QAAZ,CAAqB7F,YAAYQ,SAAZ,CAAsBiE,iBAA3C,EAA8DxD,IAA9D;AACH,KAvQI;;AAyQLP,qBAAiB,yBAASW,aAAT,EAAwB;AACrC,YAAIJ,OAAO;AACPI,2BAAeA;AADR,SAAX;AAGArB,oBAAY6F,QAAZ,CAAqB7F,YAAYQ,SAAZ,CAAsBE,eAA3C,EAA4DO,IAA5D;AACH,KA9QI;;AAgRLkE,oBAAgB,wBAASjB,MAAT,EAAiB;AAC7B9E,aAAKC,WAAL,CAAiBuB,OAAjB,CAAyB0F,UAAzB;AACAzC,gBAAQC,GAAR,CAAY,cAAZ;AACA/E,WAAGa,IAAH,CAAQ2G,qBAAR,CAA8B,KAAK7G,IAAnC;AACAX,WAAGe,QAAH,CAAYuD,SAAZ,CAAsB,OAAtB;AACH,KArRI;;AAuRLiB,mBAAe,uBAASkC,KAAT,EAAgBC,GAAhB,EAAqB;AAChC,YAAID,UAAU,IAAV,IAAgBA,UAAU,CAA9B,EAAiC;AAC7B7E,mBAAOkB,MAAP,CAAc,OAAd,EAAuB,UAASC,GAAT,EAAc;AACjC,oBAAI4D,QAAQ5D,IAAIxD,YAAJ,CAAiB,OAAjB,CAAZ;AACA,oBAAIoH,KAAJ,EAAW;AACPA,0BAAM1D,OAAN,CAAc,QAAd;AACH;AACJ,aALD;AAMAvD,uBAAW,YAAW;AAClBb,oBAAI8E,MAAJ,CAAWiD,MAAX,CAAkB,EAAlB;AACA5H,mBAAGa,IAAH,CAAQ2G,qBAAR,CAA8B,KAAK7G,IAAnC;AACAX,mBAAGe,QAAH,CAAYuD,SAAZ,CAAsB,OAAtB;AACH,aAJU,CAITJ,IAJS,CAIJ,IAJI,CAAX,EAIc,IAJd;AAKH;AACDY,gBAAQC,GAAR,CAAY,UAAU0C,KAAtB;AACA3C,gBAAQC,GAAR,CAAY,UAAU2C,GAAtB;AACH,KAvSI;;AAySLpC,kBAAc,wBAAW;AACrBR,gBAAQC,GAAR,CAAY,cAAZ;AACA,YAAIL,SAAS7E,IAAI8E,MAAJ,CAAWkD,YAAX,EAAb;AACA,YAAInD,WAAW,CAAf,EAAkB;AACdI,oBAAQC,GAAR,CAAY,gBAAgBL,MAA5B;AACH,SAFD,MAEO;AACHI,oBAAQC,GAAR,CAAY,QAAZ;AACH;AACJ,KAjTI;;AAmTLmB,0BAAsB,8BAAS1D,QAAT,EAAmB;AACrC,YAAIsF,WAAW,QAAf;AACA,YAAIC,YAAY,CAAhB;AACAhI,YAAIyC,QAAJ,GAAeA,QAAf;;AAEAsC,gBAAQC,GAAR,CAAY,eAAevC,SAASC,EAApC;;AAEA;;;;;;AAMA,YAAIiC,SAAS7E,IAAI8E,MAAJ,CAAWqD,KAAX,CAAiBxF,SAASC,EAA1B,EAA8BD,SAASyF,KAAvC,EAA6CH,QAA7C,CAAb;AACA,YAAIpD,WAAW,CAAf,EAAkB;AACdI,oBAAQC,GAAR,CAAY,cAAcL,MAA1B;AACH;AACJ,KApUI;;AAsULyB,mBAAe,uBAAS+B,IAAT,EAAe;AAC1B,YAAIA,KAAK/C,MAAL,KAAgB,GAApB,EAAyB;AACrBL,oBAAQC,GAAR,CAAY,kBAAkBmD,KAAK/C,MAAnC;AACH,SAFD,MAEO;AACHL,oBAAQC,GAAR,CAAY,MAAZ;AACA,iBAAKoD,SAAL;AACH;AACJ,KA7UI;;AA+ULA,eAAW,qBAAW;AAClB,aAAKhG,SAAL,GAAiBC,UAAUgG,IAA3B;AACA,YAAIpI,GAAGyD,MAAH,CAAUC,QAAV,CAAmBC,gBAAnB,CAAoCC,MAApC,GAA6C5D,GAAGyD,MAAH,CAAUC,QAAV,CAAmBC,gBAAnB,CAAoCE,KAArF,EAA4F;AACxFjB,mBAAOkB,MAAP,CAAc,iBAAd;AACH,SAFD,MAEO;AACHlB,mBAAOkB,MAAP,CAAc,cAAd;AACH;AACJ,KAtVI;;AAwVL;AACAuC,qBAAiB,yBAAS6B,IAAT,EAAe;AAC5B,YAAIG,UAAUC,KAAKC,KAAL,CAAWL,KAAKG,OAAhB,CAAd;;AAEA,YAAIH,KAAKG,OAAL,CAAaG,OAAb,CAAqBzI,IAAI0I,gBAAzB,KAA8C,CAAlD,EAAqD;AACjD1I,gBAAIiD,aAAJ,GAAoB,CAACjD,IAAIyC,QAAJ,CAAaC,EAAd,CAApB;AACA,iBAAKiG,MAAL,GAAc,EAAd;AACA,gBAAIC,OAAO,IAAX;AACA,gBAAIC,gBAAgBN,KAAKC,KAAL,CAAWL,KAAKG,OAAhB,EAAyBQ,OAA7C;AACAD,0BAAcE,OAAd,CAAsB,UAASrG,EAAT,EAAa;AAC/B,oBAAI1C,IAAIyC,QAAJ,CAAaC,EAAb,KAAoBA,EAAxB,EAA4B;AACxB1C,wBAAIiD,aAAJ,CAAkB+F,IAAlB,CAAuBtG,EAAvB;AACH;AACD,oBAAIe,QAAQ;AACRwF,8BAAUvG,EADF;AAERe,2BAAO;AAFC,iBAAZ;AAIAmF,qBAAKD,MAAL,CAAYK,IAAZ,CAAiBvF,KAAjB;AACH,aATD;AAUA,iBAAKW,SAAL;AACH;;AAED,YAAI8E,SAAS,IAAb;AACA,YAAIf,KAAKG,OAAL,CAAaG,OAAb,CAAqBzI,IAAImJ,iBAAzB,KAA+C,CAAnD,EAAsD;AAClDD,qBAAS5I,KAAKgD,aAAL,CAAmBC,iBAAnB,CAAqC4E,KAAKiB,SAA1C,CAAT;AACA,gBAAIF,MAAJ,EAAY;AACR,oBAAIG,WAAWH,OAAOtI,IAAP,CAAY0I,qBAAZ,CAAkCrJ,GAAGsJ,EAAH,CAAM,CAAN,EAAS,GAAT,CAAlC,CAAf;AACA,oBAAIC,cAAcN,OAAOtI,IAAP,CAAY6I,MAAZ,CAAmBA,MAAnB,CAA0BC,oBAA1B,CAA+CL,QAA/C,CAAlB;AACA,oBAAIf,QAAQqB,UAAR,KAAuBC,WAAWC,MAAtC,EAA8C;AAC1CvJ,yBAAKwJ,aAAL,CAAmBC,gBAAnB,CAAoCb,OAAOtI,IAA3C,EAAiD4I,WAAjD;AACH,iBAFD,MAEO,IAAIlB,QAAQqB,UAAR,KAAuBC,WAAWI,OAAtC,EAA+C;AAClD1J,yBAAKwJ,aAAL,CAAmBG,cAAnB,CAAkCf,OAAOtI,IAAzC,EAA+C4I,WAA/C;AACH;AACJ;AACJ;;AAED,YAAIrB,KAAKG,OAAL,CAAaG,OAAb,CAAqBzI,IAAIkK,SAAzB,KAAuC,CAA3C,EAA8C;AAC1C,iBAAKC,QAAL,GAAgBC,SAAS9B,QAAQ+B,IAAjB,CAAhB;AACA,gBAAI/B,QAAQ+B,IAAR,GAAe,CAAnB,EAAsB;AAClB/B,wBAAQ+B,IAAR,GAAe,CAAf;AACH;AACDnJ,wBAAY6F,QAAZ,CAAqB7F,YAAYQ,SAAZ,CAAsB2I,IAA3C,EAAiD/B,QAAQ+B,IAAzD;AACH;;AAED,YAAIlC,KAAKG,OAAL,CAAaG,OAAb,CAAqBzI,IAAIsK,WAAzB,KAAyC,CAA7C,EAAgD;AAC5CpB,qBAAS5I,KAAKgD,aAAL,CAAmBC,iBAAnB,CAAqC4E,KAAKiB,SAA1C,CAAT;AACA,gBAAIF,MAAJ,EAAY;AACRA,uBAAOqB,QAAP,CAAgBjC,QAAQ7E,KAAxB;AACH;AACD,gBAAI0E,KAAKiB,SAAL,KAAmBpJ,IAAIyC,QAAJ,CAAaC,EAApC,EAAwC;AACpC,qBAAKlB,IAAL,IAAa8G,QAAQ7E,KAAR,GAAgB,CAA7B;AACAvC,4BAAY6F,QAAZ,CAAqB7F,YAAYQ,SAAZ,CAAsB8I,UAA3C;AACH;AACJ;;AAED,YAAIrC,KAAKG,OAAL,CAAaG,OAAb,CAAqBzI,IAAIyK,eAAzB,KAA6C,CAAjD,EAAoD;AAChDvJ,wBAAY6F,QAAZ,CAAqB7F,YAAYQ,SAAZ,CAAsBC,QAA3C;AACA,iBAAKH,IAAL,GAAYkJ,KAAKC,KAAL,CAAW,KAAKnJ,IAAhB,CAAZ;AACH;;AAED,YAAI2G,KAAKG,OAAL,CAAaG,OAAb,CAAqBzI,IAAI4K,KAAzB,KAAmC,CAAvC,EAA0C;AACtC,iBAAKvG,QAAL;AACA,gBAAIrE,IAAI2C,WAAJ,IAAmB,KAAK0B,QAAL,IAAiBrE,IAAIiD,aAAJ,CAAkB4H,MAA1D,EAAkE;AAC9D,qBAAKC,iBAAL;AACH;AACJ;;AAED,YAAI3C,KAAKG,OAAL,CAAaG,OAAb,CAAqBzI,IAAI+K,WAAzB,KAAyC,CAA7C,EAAgD;AAC5CpK,uBAAW,YAAW;AAClBL,qBAAKC,WAAL,CAAiB6B,SAAjB,GAA6BC,UAAUC,IAAvC;AACA,qBAAK6H,QAAL,GAAgB7J,KAAK0K,WAArB;AACA,qBAAKC,UAAL;AACH,aAJU,CAIT9G,IAJS,CAIJ,IAJI,CAAX,EAIc,IAJd;AAKAjD,wBAAY6F,QAAZ,CAAqB7F,YAAYQ,SAAZ,CAAsBwJ,UAA3C;AACH;AACJ,KAnaI;;AAqaL1G,kBAAc,wBAAW;AACrB,YAAImD,MAAM,EAACwD,QAAQnL,IAAI4K,KAAb,EAAV;AACA,aAAKQ,WAAL,CAAiBzD,GAAjB;AACH,KAxaI;;AA0aLmD,uBAAmB,6BAAW;AAC1B,YAAInD,MAAM,EAACwD,QAAQnL,IAAI+K,WAAb,EAAV;AACA,aAAKK,WAAL,CAAiBzD,GAAjB;AACH,KA7aI;;AA+aLpB,iBAAa,qBAASrB,GAAT,EAAc;AACvB,aAAK,IAAImG,IAAI,CAAb,EAAgBA,IAAInG,IAAIoG,UAAJ,CAAeT,MAAnC,EAA2CQ,GAA3C,EAAgD;AAC5C,gBAAIlD,OAAOjD,IAAIoG,UAAJ,CAAeD,CAAf,CAAX;AACA,gBAAIlD,QAAQA,KAAKG,OAAb,IAAwBH,KAAKiB,SAAL,KAAmBpJ,IAAIyC,QAAJ,CAAaC,EAA5D,EAAgE;AAC5D,oBAAIyF,KAAKG,OAAL,CAAaG,OAAb,CAAqBzI,IAAIuL,qBAAzB,KAAmD,CAAvD,EAA0D;AACtD,wBAAIjD,UAAUC,KAAKC,KAAL,CAAWL,KAAKG,OAAhB,CAAd;AACA,wBAAIhI,KAAKgD,aAAT,EAAwB;AACpB,4BAAI4F,SAAS5I,KAAKgD,aAAL,CAAmBC,iBAAnB,CAAqC4E,KAAKqD,SAA1C,CAAb;AACA,4BAAItC,MAAJ,EAAY;AACRA,mCAAOuC,WAAP,CAAmBnD,QAAQoD,QAA3B;AACH;AACJ;AACJ;AACJ;AACJ;AACJ,KA9bI;;AAgcLT,gBAAY,sBAAW;AACnB,YAAIrC,OAAO,IAAX;AACA+C,sBAAc,KAAKC,MAAnB;AACA,aAAKA,MAAL,GAAcC,YAAY,YAAW;AACjC,gBAAI7L,IAAI2C,WAAR,EAAqB;AACjB,oBAAI0H,OAAOzB,KAAKuB,QAAL,GAAgB,CAA3B;AACA,oBAAIxC,MAAM;AACNwD,4BAAQnL,IAAIkK,SADN;AAENG,0BAAMA;AAFA,iBAAV;AAIA/J,qBAAKC,WAAL,CAAiB6K,WAAjB,CAA6BzD,GAA7B;AACA,oBAAI0C,OAAO,CAAP,IAAY,KAAKjI,SAAL,KAAmBC,UAAUU,IAAzC,IAAiD,KAAKX,SAAL,KAAmBC,UAAUgG,IAAlF,EAAwF;AACpFsD,kCAAc,KAAKC,MAAnB;AACA,wBAAIjE,MAAM;AACNwD,gCAAQnL,IAAIyK;AADN,qBAAV;AAGAnK,yBAAKC,WAAL,CAAiB6K,WAAjB,CAA6BzD,GAA7B;AACH;AACJ,aAdD,MAcO;AACH,oBAAIiB,KAAKuB,QAAL,GAAgB,CAAhB,IAAqB,KAAK/H,SAAL,KAAmBC,UAAUU,IAAlD,IAA0D,KAAKX,SAAL,KAAmBC,UAAUgG,IAA3F,EAAiG;AAC7FsD,kCAAc,KAAKC,MAAnB;AACH;AACJ;AACJ,SApByB,CAoBxBzH,IApBwB,CAoBnB,IApBmB,CAAZ,EAoBA,IApBA,CAAd;AAqBH,KAxdI;;AA0dLlC,yBAAqB,+BAAW;AAC5B,aAAKH,OAAL,CAAaL,EAAb,CAAgB,mCAAhB,EAAqD,UAASqK,OAAT,EAAkB;AACnEjJ,mBAAOkB,MAAP,CAAc,gBAAd,EAAgC,UAASC,GAAT,EAAc;AAC1C,oBAAI+H,cAAc/H,IAAIxD,YAAJ,CAAiB,aAAjB,CAAlB;AACAuL,4BAAY7H,OAAZ,CAAoB4H,QAAQE,SAA5B;AACH,aAHD;AAIH,SALoD,CAKnD7H,IALmD,CAK9C,IAL8C,CAArD;AAMH,KAjeI;;AAmeLjC,iCAA6B,uCAAW;AACpC,aAAKJ,OAAL,CAAaL,EAAb,CAAgB,4CAAhB,EAA8D,UAASqK,OAAT,EAAkB;AAC5E5K,wBAAY6F,QAAZ,CAAqB7F,YAAYQ,SAAZ,CAAsBuK,gBAA3C,EAA6DH,OAA7D;AACH,SAFD;AAGH,KAveI;;AAyeLI,iBAAa,uBAAW;AACpB,YAAI,CAAC,KAAKpK,OAAL,CAAaqK,WAAb,EAAL,EAAiC;AAC7B,iBAAKrK,OAAL,CAAasK,OAAb,CAAqBpM,IAAIqM,EAAzB,EAA6BrM,IAAIsM,IAAjC,EAAuC,YAAW;AAC1C,oBAAI,CAAC,KAAKxK,OAAL,CAAayK,MAAb,EAAL,EAA4B;AACxB;AACH;AACD,qBAAKzK,OAAL,CAAa0K,IAAb,CAAkB,8BAAlB,EAAkD;AAC9C,+BAAWxM,IAAIyC,QAAJ,CAAaC,EAAb,GAAkB,EADiB;AAE9C,+BAAW,GAFmC;AAG9C,gCAAYpC,KAAKC,WAAL,CAAiBkM,QAAjB,GAA4BnM,KAAKC,WAAL,CAAiBkM,QAA7C,GAAwDzM,IAAIyC,QAAJ,CAAaC,EAAb,GAAkB,EAHxC;AAI9C,gCAAYpC,KAAKC,WAAL,CAAiBmM,SAAjB,GAA6BpM,KAAKC,WAAL,CAAiBmM,SAA9C,GAA0D;AAJxB,iBAAlD;AAMA/L,2BAAW,YAAW;AAClB,yBAAKmB,OAAL,CAAa0K,IAAb,CAAkB,mCAAlB,EAAuD;AACnD,mCAAWxM,IAAIyC,QAAJ,CAAaC,EAAb,GAAkB,EADsB;AAEnD,gCAAQ;AAF2C,qBAAvD;AAIH,iBALU,CAKTyB,IALS,CAKJ,IALI,CAAX,EAKc,GALd;AAMH,aAhBkC,CAgBjCA,IAhBiC,CAgB5B,IAhB4B,CAAvC;AAkBH,SAnBD,MAmBO;AACH,iBAAKrC,OAAL,CAAa0K,IAAb,CAAkB,mCAAlB,EAAuD;AACnD,2BAAWxM,IAAIyC,QAAJ,CAAaC,EAAb,GAAkB,EADsB;AAEnD,wBAAQ;AAF2C,aAAvD;AAIH;AACJ,KAngBI;;AAqgBLiK,iBAAa,qBAASC,MAAT,EAAiB;AAC1B,YAAI,CAACtM,KAAKC,WAAL,CAAiBuB,OAAjB,CAAyBqK,WAAzB,EAAL,EAA6C;AACzC7L,iBAAKC,WAAL,CAAiBuB,OAAjB,CAAyBsK,OAAzB,CAAiCpM,IAAIqM,EAArC,EAAyCrM,IAAIsM,IAA7C,EAAmD,YAAW;AACtDhM,qBAAKC,WAAL,CAAiBuB,OAAjB,CAAyB0K,IAAzB,CAA8B,8BAA9B,EAA8D;AAC1D,+BAAWxM,IAAIyC,QAAJ,CAAaC,EAAb,GAAkB,EAD6B;AAE1D,+BAAW,GAF+C;AAG1D,gCAAYpC,KAAKC,WAAL,CAAiBkM,QAAjB,GAA4BnM,KAAKC,WAAL,CAAiBkM,QAA7C,GAAwDzM,IAAIyC,QAAJ,CAAaC,EAAb,GAAkB,EAH5B;AAI1D,gCAAYpC,KAAKC,WAAL,CAAiBmM,SAAjB,GAA6BpM,KAAKC,WAAL,CAAiBmM,SAA9C,GAA0D;AAJZ,iBAA9D;AAMA/L,2BAAW,YAAW;AAClBL,yBAAKC,WAAL,CAAiBuB,OAAjB,CAAyB0K,IAAzB,CAA8B,4CAA9B,EAA4E;AACxE,mCAAWI,SAAS;AADoD,qBAA5E;AAGH,iBAJD,EAIG,GAJH;AAKH,aAZL;AAcH,SAfD,MAeO;AACHtM,iBAAKC,WAAL,CAAiBuB,OAAjB,CAAyB0K,IAAzB,CAA8B,4CAA9B,EAA4E;AACxE,2BAAWI,SAAS;AADoD,aAA5E;AAGH;AACJ,KA1hBI;;AA4hBLxB,iBAAa,qBAASzD,GAAT,EAAc;AACvB,YAAIhD,SAAS7E,IAAI8E,MAAJ,CAAWwG,WAAX,CAAuB,CAAvB,EAA0B7C,KAAKsE,SAAL,CAAelF,GAAf,CAA1B,EAA+C,CAA/C,EAAkD3H,IAAIiD,aAAtD,CAAb;AACA,YAAI0B,OAAOA,MAAP,KAAkB,CAAtB,EAAyB;AACrBI,oBAAQC,GAAR,CAAY2C,IAAIwD,MAAhB,EAAwBxG,OAAOA,MAA/B;AACH;AACJ;AAjiBI,CAAT","file":"gameManager.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\common\\script\\basic","sourcesContent":["var mvs = require(\"Matchvs\");\r\nvar GLB = require(\"Glb\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    blockInput() {\r\n        Game.GameManager.getComponent(cc.BlockInputEvents).enabled = true;\r\n        setTimeout(function() {\r\n            Game.GameManager.node.getComponent(cc.BlockInputEvents).enabled = false;\r\n        }, 1000);\r\n    },\r\n\r\n    onLoad() {\r\n        Game.GameManager = this;\r\n        cc.game.addPersistRootNode(this.node);\r\n        cc.director.getCollisionManager().enabled = true;\r\n        clientEvent.init();\r\n        dataFunc.loadConfigs();\r\n        cc.view.enableAutoFullScreen(false);\r\n        this.coin = 100;\r\n        clientEvent.on(clientEvent.eventType.gameOver, this.gameOver, this);\r\n        clientEvent.on(clientEvent.eventType.leaveRoomNotify, this.leaveRoom, this);\r\n        this.network = window.network;\r\n        this.network.chooseNetworkMode();\r\n        this.getRankDataListener();\r\n        this.findPlayerByAccountListener();\r\n        // try {\r\n        //     wx.login({\r\n        //         success: function() {\r\n        //             wx.getUserInfo({\r\n        //                 fail: function(res) {\r\n        //                     // iOS 和 Android 对于拒绝授权的回调 errMsg 没有统一，需要做一下兼容处理\r\n        //                     if (res.errMsg.indexOf('auth deny') > -1 || res.errMsg.indexOf('auth denied') > -1) {\r\n        //                         // 处理用户拒绝授权的情况\r\n        //                         console.log(\"fail\");\r\n        //                     }\r\n        //                 },\r\n        //                 success: function(res) {\r\n        //                     Game.GameManager.nickName = res.userInfo.nickName;\r\n        //                     Game.GameManager.avatarUrl = res.userInfo.avatarUrl;\r\n        //                     console.log('success', Game.GameManager.nickName);\r\n        //                 }\r\n        //             });\r\n        //         }\r\n        //     })\r\n        // } catch (e) {\r\n        // }\r\n    },\r\n\r\n    leaveRoom: function(data) {\r\n        //切换房主\r\n        if (Game.GameManager.gameState === GameState.Play) {\r\n            if (data.leaveRoomInfo.owner === GLB.userInfo.id) {\r\n                GLB.isRoomOwner = true;\r\n            }\r\n        }\r\n    },\r\n\r\n    gameOver: function() {\r\n        // 打开结算界面--\r\n        var gamePanel = uiFunc.findUI(\"uiGamePanel\");\r\n        if (gamePanel && Game.GameManager.gameState !== GameState.Over) {\r\n            Game.GameManager.gameState = GameState.Over;\r\n            var data = [].concat(GLB.playerUserIds);\r\n            data.sort(function(a, b) {\r\n                var playerA = Game.PlayerManager.getPlayerByUserId(a);\r\n                var playerB = Game.PlayerManager.getPlayerByUserId(b);\r\n                if (playerA && playerB) {\r\n                    if (playerB.score !== playerA.score) {\r\n                        return playerB.score - playerA.score;\r\n                    } else {\r\n                        if (a === GLB.userInfo.id) {\r\n                            return -1;\r\n                        } else if (b === GLB.userInfo.id) {\r\n                            return 1;\r\n                        }\r\n                    }\r\n                }\r\n                return a - b;\r\n            })\r\n\r\n            setTimeout(function() {\r\n                if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\r\n                    uiFunc.openUI(\"uiResultVer\", function(obj) {\r\n                        var uiResultScript = obj.getComponent(\"uiResult\");\r\n                        if (uiResultScript) {\r\n                            uiResultScript.setData(data);\r\n                        }\r\n                    });\r\n                } else {\r\n                    uiFunc.openUI(\"uiResult\", function(obj) {\r\n                        var uiResultScript = obj.getComponent(\"uiResult\");\r\n                        if (uiResultScript) {\r\n                            uiResultScript.setData(data);\r\n                        }\r\n                    });\r\n                }\r\n            }.bind(this), 1500);\r\n        }\r\n    },\r\n\r\n    startGame: function() {\r\n        this.readyCnt = 0;\r\n        this.gameState = GameState.Pause;\r\n        cc.director.loadScene('game', function() {\r\n            uiFunc.openUI(\"uiGamePanel\", function() {\r\n                this.sendReadyMsg();\r\n                Game.PlayerManager.initPlayers();\r\n            }.bind(this));\r\n        }.bind(this));\r\n\r\n        if (GLB.syncFrame === true && GLB.isRoomOwner === true) {\r\n            var result = mvs.engine.setFrameSync(GLB.FRAME_RATE);\r\n            if (result !== 0) {\r\n                console.log('设置帧同步率失败,错误码:' + result);\r\n            }\r\n        }\r\n    },\r\n\r\n    setFrameSyncResponse: function(rsp) {\r\n        if (rsp.mStatus !== 200) {\r\n            console.log('设置同步帧率失败，status=' + rsp.status);\r\n        } else {\r\n            console.log('设置同步帧率成功, 帧率为:' + GLB.FRAME_RATE);\r\n        }\r\n    },\r\n\r\n    matchVsInit: function() {\r\n        mvs.response.initResponse = this.initResponse.bind(this);\r\n        mvs.response.errorResponse = this.errorResponse.bind(this);\r\n        mvs.response.joinRoomResponse = this.joinRoomResponse.bind(this);\r\n        mvs.response.joinRoomNotify = this.joinRoomNotify.bind(this);\r\n        mvs.response.leaveRoomResponse = this.leaveRoomResponse.bind(this);\r\n        mvs.response.leaveRoomNotify = this.leaveRoomNotify.bind(this);\r\n        mvs.response.joinOverResponse = this.joinOverResponse.bind(this);\r\n        mvs.response.createRoomResponse = this.createRoomResponse.bind(this);\r\n        mvs.response.getRoomListResponse = this.getRoomListResponse.bind(this);\r\n        mvs.response.getRoomDetailResponse = this.getRoomDetailResponse.bind(this);\r\n        mvs.response.getRoomListExResponse = this.getRoomListExResponse.bind(this);\r\n        mvs.response.kickPlayerResponse = this.kickPlayerResponse.bind(this);\r\n        mvs.response.kickPlayerNotify = this.kickPlayerNotify.bind(this);\r\n        mvs.response.registerUserResponse = this.registerUserResponse.bind(this);\r\n        mvs.response.loginResponse = this.loginResponse.bind(this); // 用户登录之后的回调\r\n        mvs.response.logoutResponse = this.logoutResponse.bind(this); // 用户登录之后的回调\r\n        mvs.response.sendEventNotify = this.sendEventNotify.bind(this);\r\n        mvs.response.frameUpdate = this.frameUpdate.bind(this);\r\n        mvs.response.setFrameSyncResponse = this.setFrameSyncResponse.bind(this);\r\n        mvs.response.networkStateNotify = this.networkStateNotify.bind(this);\r\n\r\n        // var result = mvs.engine.init(mvs.response, GLB.channel, GLB.platform, GLB.gameId);\r\n        var result = mvs.engine.init(mvs.response, GLB.channel, GLB.platform, GLB.gameId,\r\n            GLB.appKey, GLB.gameVersion);\r\n        if (result !== 0) {\r\n            console.log('初始化失败,错误码:' + result);\r\n        }\r\n        Game.GameManager.blockInput();\r\n    },\r\n\r\n    networkStateNotify: function(netNotify) {\r\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomMedNotify, netNotify);\r\n    },\r\n\r\n    kickPlayerNotify: function(kickPlayerNotify) {\r\n        var data = {\r\n            kickPlayerNotify: kickPlayerNotify\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.kickPlayerNotify, data);\r\n    },\r\n\r\n    kickPlayerResponse: function(kickPlayerRsp) {\r\n        if (kickPlayerRsp.status !== 200) {\r\n            console.log(\"失败kickPlayerRsp:\" + kickPlayerRsp);\r\n            return;\r\n        }\r\n        var data = {\r\n            kickPlayerRsp: kickPlayerRsp\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.kickPlayerResponse, data);\r\n    },\r\n\r\n    getRoomListExResponse: function(rsp) {\r\n        if (rsp.status !== 200) {\r\n            console.log(\"失败 rsp:\" + rsp);\r\n            return;\r\n        }\r\n        var data = {\r\n            rsp: rsp\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.getRoomListExResponse, data);\r\n    },\r\n\r\n    getRoomDetailResponse: function(rsp) {\r\n        if (rsp.status !== 200) {\r\n            console.log(\"失败 rsp:\" + rsp);\r\n            return;\r\n        }\r\n        var data = {\r\n            rsp: rsp\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.getRoomDetailResponse, data);\r\n    },\r\n\r\n    getRoomListResponse: function(status, roomInfos) {\r\n        if (status !== 200) {\r\n            console.log(\"失败 status:\" + status);\r\n            return;\r\n        }\r\n        var data = {\r\n            status: status,\r\n            roomInfos: roomInfos\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.getRoomListResponse, data);\r\n    },\r\n\r\n    createRoomResponse: function(rsp) {\r\n        if (rsp.status !== 200) {\r\n            console.log(\"失败 createRoomResponse:\" + rsp);\r\n            return;\r\n        }\r\n        var data = {\r\n            rsp: rsp\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.createRoomResponse, data);\r\n    },\r\n\r\n    joinOverResponse: function(joinOverRsp) {\r\n        if (joinOverRsp.status !== 200) {\r\n            console.log(\"失败 joinOverRsp:\" + joinOverRsp);\r\n            return;\r\n        }\r\n        var data = {\r\n            joinOverRsp: joinOverRsp\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.joinOverResponse, data);\r\n    },\r\n\r\n    joinRoomResponse: function(status, roomUserInfoList, roomInfo) {\r\n        if (status !== 200) {\r\n            console.log(\"失败 joinRoomResponse:\" + status);\r\n            return;\r\n        }\r\n        var data = {\r\n            status: status,\r\n            roomUserInfoList: roomUserInfoList,\r\n            roomInfo: roomInfo\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.joinRoomResponse, data);\r\n    },\r\n\r\n    joinRoomNotify: function(roomUserInfo) {\r\n        var data = {\r\n            roomUserInfo: roomUserInfo\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.joinRoomNotify, data);\r\n    },\r\n\r\n    leaveRoomResponse: function(leaveRoomRsp) {\r\n        if (leaveRoomRsp.status !== 200) {\r\n            console.log(\"失败 leaveRoomRsp:\" + leaveRoomRsp);\r\n            return;\r\n        }\r\n        var data = {\r\n            leaveRoomRsp: leaveRoomRsp\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomResponse, data);\r\n    },\r\n\r\n    leaveRoomNotify: function(leaveRoomInfo) {\r\n        var data = {\r\n            leaveRoomInfo: leaveRoomInfo\r\n        }\r\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomNotify, data);\r\n    },\r\n\r\n    logoutResponse: function(status) {\r\n        Game.GameManager.network.disconnect();\r\n        console.log(\"reload lobby\");\r\n        cc.game.removePersistRootNode(this.node);\r\n        cc.director.loadScene('lobby');\r\n    },\r\n\r\n    errorResponse: function(error, msg) {\r\n        if (error === 1001||error === 0) {\r\n            uiFunc.openUI(\"uiTip\", function(obj) {\r\n                var uiTip = obj.getComponent(\"uiTip\");\r\n                if (uiTip) {\r\n                    uiTip.setData(\"网络断开连接\");\r\n                }\r\n            });\r\n            setTimeout(function() {\r\n                mvs.engine.logout(\"\");\r\n                cc.game.removePersistRootNode(this.node);\r\n                cc.director.loadScene('lobby');\r\n            }.bind(this), 2500);\r\n        }\r\n        console.log(\"错误信息：\" + error);\r\n        console.log(\"错误信息：\" + msg);\r\n    },\r\n\r\n    initResponse: function() {\r\n        console.log('初始化成功，开始注册用户');\r\n        var result = mvs.engine.registerUser();\r\n        if (result !== 0) {\r\n            console.log('注册用户失败，错误码:' + result);\r\n        } else {\r\n            console.log('注册用户成功');\r\n        }\r\n    },\r\n\r\n    registerUserResponse: function(userInfo) {\r\n        var deviceId = 'abcdef';\r\n        var gatewayId = 0;\r\n        GLB.userInfo = userInfo;\r\n\r\n        console.log('开始登录,用户Id:' + userInfo.id)\r\n\r\n        /*var result = mvs.engine.login(\r\n            userInfo.id, userInfo.token,\r\n            GLB.gameId, GLB.gameVersion,\r\n            GLB.appKey, GLB.secret,\r\n            deviceId, gatewayId\r\n        );*/\r\n        var result = mvs.engine.login(userInfo.id, userInfo.token,deviceId);\r\n        if (result !== 0) {\r\n            console.log('登录失败,错误码:' + result);\r\n        }\r\n    },\r\n\r\n    loginResponse: function(info) {\r\n        if (info.status !== 200) {\r\n            console.log('登录失败,异步回调错误码:' + info.status);\r\n        } else {\r\n            console.log('登录成功');\r\n            this.lobbyShow();\r\n        }\r\n    },\r\n\r\n    lobbyShow: function() {\r\n        this.gameState = GameState.None;\r\n        if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\r\n            uiFunc.openUI(\"uiLobbyPanelVer\");\r\n        } else {\r\n            uiFunc.openUI(\"uiLobbyPanel\");\r\n        }\r\n    },\r\n\r\n    // 玩家行为通知--\r\n    sendEventNotify: function(info) {\r\n        var cpProto = JSON.parse(info.cpProto);\r\n\r\n        if (info.cpProto.indexOf(GLB.GAME_START_EVENT) >= 0) {\r\n            GLB.playerUserIds = [GLB.userInfo.id]\r\n            this.scores = [];\r\n            var self = this;\r\n            var remoteUserIds = JSON.parse(info.cpProto).userIds;\r\n            remoteUserIds.forEach(function(id) {\r\n                if (GLB.userInfo.id !== id) {\r\n                    GLB.playerUserIds.push(id)\r\n                }\r\n                var score = {\r\n                    playerId: id,\r\n                    score: 0\r\n                }\r\n                self.scores.push(score);\r\n            });\r\n            this.startGame();\r\n        }\r\n\r\n        var player = null;\r\n        if (info.cpProto.indexOf(GLB.PLAYER_FIRE_EVENT) >= 0) {\r\n            player = Game.PlayerManager.getPlayerByUserId(info.srcUserId);\r\n            if (player) {\r\n                var worldPos = player.node.convertToWorldSpaceAR(cc.v2(0, 177));\r\n                var bulletPoint = player.node.parent.parent.convertToNodeSpaceAR(worldPos);\r\n                if (cpProto.bulletType === BulletType.Normal) {\r\n                    Game.BulletManager.spawnSmallBullet(player.node, bulletPoint);\r\n                } else if (cpProto.bulletType === BulletType.Special) {\r\n                    Game.BulletManager.spawnBigBullet(player.node, bulletPoint);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (info.cpProto.indexOf(GLB.GAME_TIME) >= 0) {\r\n            this.gameTime = parseInt(cpProto.time);\r\n            if (cpProto.time < 0) {\r\n                cpProto.time = 0;\r\n            }\r\n            clientEvent.dispatch(clientEvent.eventType.time, cpProto.time);\r\n        }\r\n\r\n        if (info.cpProto.indexOf(GLB.SCORE_EVENT) >= 0) {\r\n            player = Game.PlayerManager.getPlayerByUserId(info.srcUserId);\r\n            if (player) {\r\n                player.addScore(cpProto.score);\r\n            }\r\n            if (info.srcUserId === GLB.userInfo.id) {\r\n                this.coin += cpProto.score / 5;\r\n                clientEvent.dispatch(clientEvent.eventType.updateCoin);\r\n            }\r\n        }\r\n\r\n        if (info.cpProto.indexOf(GLB.GAME_OVER_EVENT) >= 0) {\r\n            clientEvent.dispatch(clientEvent.eventType.gameOver);\r\n            this.coin = Math.floor(this.coin);\r\n        }\r\n\r\n        if (info.cpProto.indexOf(GLB.READY) >= 0) {\r\n            this.readyCnt++;\r\n            if (GLB.isRoomOwner && this.readyCnt >= GLB.playerUserIds.length) {\r\n                this.sendRoundStartMsg();\r\n            }\r\n        }\r\n\r\n        if (info.cpProto.indexOf(GLB.ROUND_START) >= 0) {\r\n            setTimeout(function() {\r\n                Game.GameManager.gameState = GameState.Play;\r\n                this.gameTime = Game.GameSeconds;\r\n                this.timeUpdate();\r\n            }.bind(this), 7000);\r\n            clientEvent.dispatch(clientEvent.eventType.roundStart);\r\n        }\r\n    },\r\n\r\n    sendReadyMsg: function() {\r\n        var msg = {action: GLB.READY};\r\n        this.sendEventEx(msg);\r\n    },\r\n\r\n    sendRoundStartMsg: function() {\r\n        var msg = {action: GLB.ROUND_START};\r\n        this.sendEventEx(msg);\r\n    },\r\n\r\n    frameUpdate: function(rsp) {\r\n        for (var i = 0; i < rsp.frameItems.length; i++) {\r\n            var info = rsp.frameItems[i];\r\n            if (info && info.cpProto && info.srcUserId !== GLB.userInfo.id) {\r\n                if (info.cpProto.indexOf(GLB.PLAYER_ROTATION_EVENT) >= 0) {\r\n                    var cpProto = JSON.parse(info.cpProto);\r\n                    if (Game.PlayerManager) {\r\n                        var player = Game.PlayerManager.getPlayerByUserId(info.srcUserID);\r\n                        if (player) {\r\n                            player.setRotation(cpProto.rotation);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    timeUpdate: function() {\r\n        var self = this;\r\n        clearInterval(this.timeId);\r\n        this.timeId = setInterval(function() {\r\n            if (GLB.isRoomOwner) {\r\n                var time = self.gameTime - 1;\r\n                var msg = {\r\n                    action: GLB.GAME_TIME,\r\n                    time: time\r\n                };\r\n                Game.GameManager.sendEventEx(msg);\r\n                if (time < 0 || this.gameState === GameState.Over || this.gameState === GameState.None) {\r\n                    clearInterval(this.timeId);\r\n                    var msg = {\r\n                        action: GLB.GAME_OVER_EVENT,\r\n                    };\r\n                    Game.GameManager.sendEventEx(msg);\r\n                }\r\n            } else {\r\n                if (self.gameTime < 0 || this.gameState === GameState.Over || this.gameState === GameState.None) {\r\n                    clearInterval(this.timeId);\r\n                }\r\n            }\r\n        }.bind(this), 1000);\r\n    },\r\n\r\n    getRankDataListener: function() {\r\n        this.network.on(\"connector.rankHandler.getRankData\", function(recvMsg) {\r\n            uiFunc.openUI(\"uiRankPanelVer\", function(obj) {\r\n                var uiRankPanel = obj.getComponent(\"uiRankPanel\");\r\n                uiRankPanel.setData(recvMsg.rankArray);\r\n            });\r\n        }.bind(this));\r\n    },\r\n\r\n    findPlayerByAccountListener: function() {\r\n        this.network.on(\"connector.entryHandler.findPlayerByAccount\", function(recvMsg) {\r\n            clientEvent.dispatch(clientEvent.eventType.playerAccountGet, recvMsg);\r\n        });\r\n    },\r\n\r\n    loginServer: function() {\r\n        if (!this.network.isConnected()) {\r\n            this.network.connect(GLB.IP, GLB.PORT, function() {\r\n                    if (!this.network.isOpen()) {\r\n                        return;\r\n                    }\r\n                    this.network.send(\"connector.entryHandler.login\", {\r\n                        \"account\": GLB.userInfo.id + \"\",\r\n                        \"channel\": \"0\",\r\n                        \"userName\": Game.GameManager.nickName ? Game.GameManager.nickName : GLB.userInfo.id + \"\",\r\n                        \"headIcon\": Game.GameManager.avatarUrl ? Game.GameManager.avatarUrl : \"-\"\r\n                    });\r\n                    setTimeout(function() {\r\n                        this.network.send(\"connector.rankHandler.updateScore\", {\r\n                            \"account\": GLB.userInfo.id + \"\",\r\n                            \"game\": \"game3\"\r\n                        });\r\n                    }.bind(this), 500);\r\n                }.bind(this)\r\n            );\r\n        } else {\r\n            this.network.send(\"connector.rankHandler.updateScore\", {\r\n                \"account\": GLB.userInfo.id + \"\",\r\n                \"game\": \"game3\"\r\n            });\r\n        }\r\n    },\r\n\r\n    userInfoReq: function(userId) {\r\n        if (!Game.GameManager.network.isConnected()) {\r\n            Game.GameManager.network.connect(GLB.IP, GLB.PORT, function() {\r\n                    Game.GameManager.network.send(\"connector.entryHandler.login\", {\r\n                        \"account\": GLB.userInfo.id + \"\",\r\n                        \"channel\": \"0\",\r\n                        \"userName\": Game.GameManager.nickName ? Game.GameManager.nickName : GLB.userInfo.id + \"\",\r\n                        \"headIcon\": Game.GameManager.avatarUrl ? Game.GameManager.avatarUrl : \"-\"\r\n                    });\r\n                    setTimeout(function() {\r\n                        Game.GameManager.network.send(\"connector.entryHandler.findPlayerByAccount\", {\r\n                            \"account\": userId + \"\",\r\n                        });\r\n                    }, 200);\r\n                }\r\n            );\r\n        } else {\r\n            Game.GameManager.network.send(\"connector.entryHandler.findPlayerByAccount\", {\r\n                \"account\": userId + \"\",\r\n            });\r\n        }\r\n    },\r\n\r\n    sendEventEx: function(msg) {\r\n        var result = mvs.engine.sendEventEx(0, JSON.stringify(msg), 0, GLB.playerUserIds);\r\n        if (result.result !== 0) {\r\n            console.log(msg.action, result.result);\r\n        }\r\n    }\r\n});\r\n"]}