{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\common\\script/assets\\common\\script\\uiCreateRoom.js"],"names":["uiPanel","require","mvs","GLB","cc","Class","extends","properties","onLoad","_super","playerCntLb","nodeDict","getComponent","Label","playerCnt","PLAYER_COUNTS","string","refreshBtnState","on","quit","addPlayerCount","subPlayerCount","createRoom","clientEvent","eventType","createRoomResponse","i","length","Button","interactable","uiFunc","closeUI","node","name","destroy","Game","GameManager","blockInput","create","CreateRoomInfo","roomName","EditBox","MAX_PLAYER_COUNT","maxPlayer","mode","canWatch","visibility","roomProperty","result","engine","console","log","data","status","rsp","JSON","stringify","roomID","roomId","Canvas","instance","designResolution","height","width","openUI","obj","room","createRoomInit","bind","onDestroy","window","wx","offKeyboardComplete","offKeyboardInput","hideKeyboard","off"],"mappings":";;;;;;AAAA,IAAIA,UAAUC,QAAQ,SAAR,CAAd;AACA,IAAIC,MAAMD,QAAQ,SAAR,CAAV;AACA,IAAIE,MAAMF,QAAQ,KAAR,CAAV;AACAG,GAAGC,KAAH,CAAS;AACLC,aAASN,OADJ;AAELO,gBAAY,EAFP;;AAILC,UAJK,oBAII;AACL,aAAKC,MAAL;AACA,aAAKC,WAAL,GAAmB,KAAKC,QAAL,CAAc,WAAd,EAA2BC,YAA3B,CAAwCR,GAAGS,KAA3C,CAAnB;AACA,aAAKC,SAAL,GAAiBX,IAAIY,aAAJ,CAAkB,CAAlB,CAAjB;AACA,aAAKL,WAAL,CAAiBM,MAAjB,GAA0B,KAAKF,SAA/B;AACA,aAAKG,eAAL;AACA,aAAKN,QAAL,CAAc,MAAd,EAAsBO,EAAtB,CAAyB,OAAzB,EAAkC,KAAKC,IAAvC,EAA6C,IAA7C;AACA,aAAKR,QAAL,CAAc,SAAd,EAAyBO,EAAzB,CAA4B,OAA5B,EAAqC,KAAKE,cAA1C,EAA0D,IAA1D;AACA,aAAKT,QAAL,CAAc,SAAd,EAAyBO,EAAzB,CAA4B,OAA5B,EAAqC,KAAKG,cAA1C,EAA0D,IAA1D;AACA,aAAKV,QAAL,CAAc,QAAd,EAAwBO,EAAxB,CAA2B,OAA3B,EAAoC,KAAKI,UAAzC,EAAqD,IAArD;;AAEAC,oBAAYL,EAAZ,CAAeK,YAAYC,SAAZ,CAAsBC,kBAArC,EAAyD,KAAKA,kBAA9D,EAAkF,IAAlF;AACH,KAhBI;;;AAkBLL,oBAAgB,0BAAW;AACvB,aAAK,IAAIM,IAAI,CAAb,EAAgBA,IAAIvB,IAAIY,aAAJ,CAAkBY,MAAtC,EAA8CD,GAA9C,EAAmD;AAC/C,gBAAI,KAAKZ,SAAL,KAAmBX,IAAIY,aAAJ,CAAkBW,CAAlB,CAAvB,EAA6C;AACzC,oBAAIvB,IAAIY,aAAJ,CAAkBY,MAAlB,GAA2BD,IAAI,CAAnC,EAAsC;AAClC,yBAAKZ,SAAL,GAAiBX,IAAIY,aAAJ,CAAkBW,IAAI,CAAtB,CAAjB;AACA;AACH;AACJ;AACJ;;AAED,aAAKhB,WAAL,CAAiBM,MAAjB,GAA0B,KAAKF,SAA/B;AACA,aAAKG,eAAL;AACH,KA9BI;;AAgCLI,oBAAgB,0BAAW;AACvB,aAAK,IAAIK,IAAI,CAAb,EAAgBA,IAAIvB,IAAIY,aAAJ,CAAkBY,MAAtC,EAA8CD,GAA9C,EAAmD;AAC/C,gBAAI,KAAKZ,SAAL,KAAmBX,IAAIY,aAAJ,CAAkBW,CAAlB,CAAvB,EAA6C;AACzC,oBAAIA,IAAI,CAAR,EAAW;AACP,yBAAKZ,SAAL,GAAiBX,IAAIY,aAAJ,CAAkBW,IAAI,CAAtB,CAAjB;AACA;AACH;AACJ;AACJ;AACD,aAAKhB,WAAL,CAAiBM,MAAjB,GAA0B,KAAKF,SAA/B;AACA,aAAKG,eAAL;AACH,KA3CI;;AA6CLA,mBA7CK,6BA6Ca;AACd,YAAI,KAAKH,SAAL,KAAmBX,IAAIY,aAAJ,CAAkB,CAAlB,CAAvB,EAA6C;AACzC,iBAAKJ,QAAL,CAAc,SAAd,EAAyBC,YAAzB,CAAsCR,GAAGwB,MAAzC,EAAiDC,YAAjD,GAAgE,KAAhE;AACH,SAFD,MAEO;AACH,iBAAKlB,QAAL,CAAc,SAAd,EAAyBC,YAAzB,CAAsCR,GAAGwB,MAAzC,EAAiDC,YAAjD,GAAgE,IAAhE;AACH;;AAED,YAAI,KAAKf,SAAL,KAAmBX,IAAIY,aAAJ,CAAkBZ,IAAIY,aAAJ,CAAkBY,MAAlB,GAA2B,CAA7C,CAAvB,EAAwE;AACpE,iBAAKhB,QAAL,CAAc,SAAd,EAAyBC,YAAzB,CAAsCR,GAAGwB,MAAzC,EAAiDC,YAAjD,GAAgE,KAAhE;AACH,SAFD,MAEO;AACH,iBAAKlB,QAAL,CAAc,SAAd,EAAyBC,YAAzB,CAAsCR,GAAGwB,MAAzC,EAAiDC,YAAjD,GAAgE,IAAhE;AACH;AACJ,KAzDI;;;AA2DLV,UAAM,gBAAW;AACbW,eAAOC,OAAP,CAAe,KAAKC,IAAL,CAAUC,IAAzB;AACA,aAAKD,IAAL,CAAUE,OAAV;AACH,KA9DI;;AAgELZ,gBAAY,sBAAW;AACnBa,aAAKC,WAAL,CAAiBC,UAAjB;;AAEA,YAAIC,SAAS,IAAIpC,IAAIqC,cAAR,EAAb;AACAD,eAAOE,QAAP,GAAkB,KAAK7B,QAAL,CAAc,UAAd,EAA0BC,YAA1B,CAAuCR,GAAGqC,OAA1C,EAAmDzB,MAArE;AACAb,YAAIuC,gBAAJ,GAAuB,KAAK5B,SAA5B;AACAwB,eAAOK,SAAP,GAAmBxC,IAAIuC,gBAAvB;AACAJ,eAAOM,IAAP,GAAc,CAAd;AACAN,eAAOO,QAAP,GAAkB,CAAlB;AACAP,eAAOQ,UAAP,GAAoB,CAApB;AACAR,eAAOS,YAAP,GAAsB5C,IAAIuC,gBAA1B;AACA,YAAIM,SAAS9C,IAAI+C,MAAJ,CAAW3B,UAAX,CAAsBgB,MAAtB,EAA8B,EAAEK,WAAWxC,IAAIuC,gBAAjB,EAA9B,CAAb;AACA,YAAIM,WAAW,CAAf,EAAkB;AACdE,oBAAQC,GAAR,CAAY,gBAAgBH,MAA5B;AACH;AACJ,KA/EI;;AAiFLvB,wBAAoB,4BAAS2B,IAAT,EAAe;AAC/B,YAAIC,SAASD,KAAKE,GAAL,CAASD,MAAtB;AACA,YAAIA,WAAW,GAAf,EAAoB;AAChBH,oBAAQC,GAAR,CAAY,qBAAqBE,MAAjC;AACH,SAFD,MAEO;AACHH,oBAAQC,GAAR,CAAY,YAAYI,KAAKC,SAAL,CAAeJ,KAAKE,GAApB,CAAxB;AACAJ,oBAAQC,GAAR,CAAY,UAAUC,KAAKE,GAAL,CAASG,MAA/B;AACAtD,gBAAIuD,MAAJ,GAAaN,KAAKE,GAAL,CAASG,MAAtB;;AAEA,gBAAIrD,GAAGuD,MAAH,CAAUC,QAAV,CAAmBC,gBAAnB,CAAoCC,MAApC,GAA6C1D,GAAGuD,MAAH,CAAUC,QAAV,CAAmBC,gBAAnB,CAAoCE,KAArF,EAA4F;AACxFjC,uBAAOkC,MAAP,CAAc,WAAd,EAA2B,UAASC,GAAT,EAAc;AACrC,wBAAIC,OAAOD,IAAIrD,YAAJ,CAAiB,QAAjB,CAAX;AACAsD,yBAAKC,cAAL,CAAoBf,KAAKE,GAAzB;AACAxB,2BAAOC,OAAP,CAAe,KAAKC,IAAL,CAAUC,IAAzB;AACA,yBAAKD,IAAL,CAAUE,OAAV;AACH,iBAL0B,CAKzBkC,IALyB,CAKpB,IALoB,CAA3B;AAMH,aAPD,MAOO;AACHtC,uBAAOkC,MAAP,CAAc,QAAd,EAAwB,UAASC,GAAT,EAAc;AAClC,wBAAIC,OAAOD,IAAIrD,YAAJ,CAAiB,QAAjB,CAAX;AACAsD,yBAAKC,cAAL,CAAoBf,KAAKE,GAAzB;AACAxB,2BAAOC,OAAP,CAAe,KAAKC,IAAL,CAAUC,IAAzB;AACA,yBAAKD,IAAL,CAAUE,OAAV;AACH,iBALuB,CAKtBkC,IALsB,CAKjB,IALiB,CAAxB;AAMH;AACJ;AACJ,KA1GI;;AA4GLC,eAAW,qBAAW;AAClB,YAAIC,OAAOC,EAAX,EAAe;AACXA,eAAGC,mBAAH;AACAD,eAAGE,gBAAH;AACAF,eAAGG,YAAH;AACH;AACDnD,oBAAYoD,GAAZ,CAAgBpD,YAAYC,SAAZ,CAAsBC,kBAAtC,EAA0D,KAAKA,kBAA/D,EAAmF,IAAnF;AACH;AAnHI,CAAT","file":"uiCreateRoom.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\common\\script","sourcesContent":["var uiPanel = require(\"uiPanel\");\r\nvar mvs = require(\"Matchvs\");\r\nvar GLB = require(\"Glb\");\r\ncc.Class({\r\n    extends: uiPanel,\r\n    properties: {},\r\n\r\n    onLoad() {\r\n        this._super();\r\n        this.playerCntLb = this.nodeDict[\"playerCnt\"].getComponent(cc.Label);\r\n        this.playerCnt = GLB.PLAYER_COUNTS[0];\r\n        this.playerCntLb.string = this.playerCnt;\r\n        this.refreshBtnState();\r\n        this.nodeDict[\"quit\"].on(\"click\", this.quit, this);\r\n        this.nodeDict[\"addNode\"].on(\"click\", this.addPlayerCount, this);\r\n        this.nodeDict[\"subNode\"].on(\"click\", this.subPlayerCount, this);\r\n        this.nodeDict[\"create\"].on(\"click\", this.createRoom, this);\r\n\r\n        clientEvent.on(clientEvent.eventType.createRoomResponse, this.createRoomResponse, this);\r\n    },\r\n\r\n    addPlayerCount: function() {\r\n        for (var i = 0; i < GLB.PLAYER_COUNTS.length; i++) {\r\n            if (this.playerCnt === GLB.PLAYER_COUNTS[i]) {\r\n                if (GLB.PLAYER_COUNTS.length > i + 1) {\r\n                    this.playerCnt = GLB.PLAYER_COUNTS[i + 1];\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        this.playerCntLb.string = this.playerCnt;\r\n        this.refreshBtnState();\r\n    },\r\n\r\n    subPlayerCount: function() {\r\n        for (var i = 0; i < GLB.PLAYER_COUNTS.length; i++) {\r\n            if (this.playerCnt === GLB.PLAYER_COUNTS[i]) {\r\n                if (i > 0) {\r\n                    this.playerCnt = GLB.PLAYER_COUNTS[i - 1];\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        this.playerCntLb.string = this.playerCnt;\r\n        this.refreshBtnState();\r\n    },\r\n\r\n    refreshBtnState() {\r\n        if (this.playerCnt === GLB.PLAYER_COUNTS[0]) {\r\n            this.nodeDict[\"subNode\"].getComponent(cc.Button).interactable = false;\r\n        } else {\r\n            this.nodeDict[\"subNode\"].getComponent(cc.Button).interactable = true;\r\n        }\r\n\r\n        if (this.playerCnt === GLB.PLAYER_COUNTS[GLB.PLAYER_COUNTS.length - 1]) {\r\n            this.nodeDict[\"addNode\"].getComponent(cc.Button).interactable = false;\r\n        } else {\r\n            this.nodeDict[\"addNode\"].getComponent(cc.Button).interactable = true;\r\n        }\r\n    },\r\n\r\n    quit: function() {\r\n        uiFunc.closeUI(this.node.name);\r\n        this.node.destroy();\r\n    },\r\n\r\n    createRoom: function() {\r\n        Game.GameManager.blockInput();\r\n\r\n        var create = new mvs.CreateRoomInfo();\r\n        create.roomName = this.nodeDict[\"roomName\"].getComponent(cc.EditBox).string;\r\n        GLB.MAX_PLAYER_COUNT = this.playerCnt;\r\n        create.maxPlayer = GLB.MAX_PLAYER_COUNT;\r\n        create.mode = 0;\r\n        create.canWatch = 0;\r\n        create.visibility = 1;\r\n        create.roomProperty = GLB.MAX_PLAYER_COUNT;\r\n        var result = mvs.engine.createRoom(create, { maxPlayer: GLB.MAX_PLAYER_COUNT });\r\n        if (result !== 0) {\r\n            console.log('创建房间失败,错误码:' + result);\r\n        }\r\n    },\r\n\r\n    createRoomResponse: function(data) {\r\n        var status = data.rsp.status;\r\n        if (status !== 200) {\r\n            console.log('创建房间失败,异步回调错误码: ' + status);\r\n        } else {\r\n            console.log('创建房间成功:' + JSON.stringify(data.rsp));\r\n            console.log('房间号: ' + data.rsp.roomID);\r\n            GLB.roomId = data.rsp.roomID;\r\n\r\n            if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\r\n                uiFunc.openUI(\"uiRoomVer\", function(obj) {\r\n                    var room = obj.getComponent('uiRoom');\r\n                    room.createRoomInit(data.rsp);\r\n                    uiFunc.closeUI(this.node.name);\r\n                    this.node.destroy();\r\n                }.bind(this));\r\n            } else {\r\n                uiFunc.openUI(\"uiRoom\", function(obj) {\r\n                    var room = obj.getComponent('uiRoom');\r\n                    room.createRoomInit(data.rsp);\r\n                    uiFunc.closeUI(this.node.name);\r\n                    this.node.destroy();\r\n                }.bind(this));\r\n            }\r\n        }\r\n    },\r\n\r\n    onDestroy: function() {\r\n        if (window.wx) {\r\n            wx.offKeyboardComplete();\r\n            wx.offKeyboardInput();\r\n            wx.hideKeyboard();\r\n        }\r\n        clientEvent.off(clientEvent.eventType.createRoomResponse, this.createRoomResponse, this);\r\n    }\r\n});\r\n"]}